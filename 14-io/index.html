<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>Progettazione e Sviluppo del Software</title>
<meta name="description" content="Progettazione e Sviluppo del Software, Tecnologie dei Sistemi Informatici">
<meta name="author" content="Danilo Pianini">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/css/custom-theme.min.b14bd2cb8ebd9f5aadd1914151911df5ab7b2264253b1df19c307933796d5e56.css" id="theme"><link rel="stylesheet" href="/highlight-js/default.min.css">
    
<link rel="stylesheet" href="https://gitcdn.link/repo/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="inputoutput">Input/Output</h1>
<!-- <h4 id="progettazione-e-sviluppo-del-software">Progettazione e Sviluppo del Software</h4>
<h4 id="cdl-tecnologie-dei-sistemi-informatici">C.D.L. Tecnologie dei Sistemi Informatici</h4>
<h3 id="roberto-casadei-----robycasadeiuniboitmailtorobycasadeiuniboit"><a href="mailto:roby.casadei@unibo.it">Roberto Casadei &mdash; <code>roby.casadei@unibo.it</code></a></h3>
<h3 id="danilo-pianini-----danilopianiniuniboitmailtodanilopianiniuniboit"><a href="mailto:danilo.pianini@unibo.it">Danilo Pianini &mdash; <code>danilo.pianini@unibo.it</code></a></h3>
<p><a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> versione stampabile</a></p>
</section><section> -->
<h4 id="progettazione-e-sviluppo-del-software">Progettazione e Sviluppo del Software</h4>
<h4 id="cdl-tecnologie-dei-sistemi-informatici">C.D.L. Tecnologie dei Sistemi Informatici</h4>
<h3 id="roberto-casadei-----robycasadeiuniboitmailtorobycasadeiuniboit"><a href="mailto:roby.casadei@unibo.it">Roberto Casadei — <code>roby.casadei@unibo.it</code></a></h3>
<h3 id="danilo-pianini-----danilopianiniuniboitmailtodanilopianiniuniboit"><a href="mailto:danilo.pianini@unibo.it">Danilo Pianini — <code>danilo.pianini@unibo.it</code></a></h3>
<p><a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> versione stampabile</a></p>
</section><section>
<h2 id="nota">Nota</h2>
<ul>
<li>
<p>Questo materiale è ampiamente basato su quello realizzato dal Prof.
Mirko Viroli, che ringrazio.</p>
</li>
<li>
<p>Ogni errore riscontratovi è esclusiva responsabilità degli autori di questo documento.</p>
</li>
</ul>
</section><section>
<h2 id="outline">Outline</h2>
<h3 id="goal-della-lezione">Goal della lezione</h3>
<ul>
<li>Illustrare le API fornite da Java per l’I/O</li>
<li>Descrivere alcune scelte progettuali e pattern</li>
<li>Mostrare esempi di applicazione</li>
</ul>
<h3 id="argomenti">Argomenti</h3>
<ul>
<li>Classi per gestire file</li>
<li>Classi per gestire Stream (di input/output)</li>
<li>Serializzazione di oggetti</li>
<li>Classi per gestire file di testo</li>
<li>Pattern Decorator</li>
</ul>
</section><section>
<h2 id="il-problema-dellinputoutput">Il problema dell’Input/Output</h2>
<h3 id="uno-dei-problemi-fondamentali-per-un-sistema-operativo">Uno dei problemi fondamentali per un sistema operativo</h3>
<pre><code>*  Gestire le comunicazioni fra CPU e dispositivi affacciati sul BUS{

*  Console, tastiera, mouse, dischi, rete, sensori, schermo
</code></pre>
<p>}
*  Vi sono varie modalità di interazione possibili{</p>
<pre><code>*  sequenziale, random-access, buffered, per carattere/linea/byte/oggetto
</code></pre>
<p>}
*  I sistemi operativi offrono vari meccanismi{</p>
<pre><code>*  file, I/O control interface, socket per il networking, video driver
</code></pre>
<p>}</p>
<h3 id="la-libreria-javaio">La libreria <code>java.io.*</code></h3>
<pre><code>*  Fornisce i concetti di File e Stream di dati
*  Consente una gestione flessibile dei vari aspetti
*  È estesa con la libreria `java.nio`, che vedremo poi
*  È la base di librerie avanzate (networking,..), anche non-JDK (JSON,..)
*  I/O con l'utente in ambiente a finestre è realizzato con le GUI
</code></pre>
</section><section>
<h2 id="la-libreria-javaio-1">La libreria <code>java.io</code></h2>
<pre><code>![](img/io.png)
</code></pre>
</section><section>
<h2 id="i-macro-elementi-della-libreria">I macro-elementi della libreria</h2>
<h3 id="outline-della-lezione">Outline della lezione</h3>
<pre><code>*  File
*  Stream di ingresso e uscita
*  File ad accesso "random"
*  Stream di oggetti e serializzazione
*  Reader e Writer di testi
</code></pre>
</section><section>
<p>\section[File e proprietà]{File e loro proprietà}</p>
<h2 id="i-file">I File</h2>
<h3 id="file-system">File system</h3>
<pre><code>*  Il file system è un modulo del S.O. che gestisce la memoria secondaria
*  Maschera le diversità di dispositivi fisici (HD, CD, DVD, BR, SSD,..)
*  Maschera le diversità di contenuti informativi (testi, filmati, archivi,..)
*  Fornisce meccanismi per fornire prestazioni, concorrenza, robustezza
</code></pre>
<h3 id="file">File</h3>
<pre><code>*  Un file system contiene un insieme di *__file__*
*  Un file ha un contenuto informativo, ossia un insieme di byte{

    *  interpretabili in vario modo (testi, programmi, strutture dati)
    *  potrebbe essere un file virtuale, che mappa un dispositivo
    *  un caso particolare è la directory (ossia una tabella di ID di file)
</code></pre>
<p>}
*  Si ha una organizzazione gerarchica in cartelle (un file ha un path)
*  Un file ha un ID, nome, percorso, diritti di accesso, dimensione, \ldots{}</p>
</section><section>
<h2 id="la-classe-javaiofile">La classe <code>java.io.File</code></h2>
<h3 id="usi">Usi</h3>
<pre><code>    *  Serve a identificare un preciso file su file systems
    *  Permette di ottenere informazioni varie sul file
    *  Permette di effettuare alcune operazioni complessive (cancellazione, renaming)
    *  Permette di impostare alcune proprietà (se eseguibile, se scrivibile)
    *  Permette di ottenere informazioni generali sul file systems
    *  Permette di creare cartelle
    * $\Rightarrow$ non include operazioni per accedere al suo contenuto, ma vi si potrà agganciare uno stream
</code></pre>
</section><section>
<h2 id="classe-javaiofile-pt1">Classe <code>java.io.File</code>: pt1</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span> <span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">File</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Serializable</span><span style="color:#000">,</span> <span style="color:#000">Comparable</span><span style="color:#000">&lt;</span><span style="color:#000">File</span><span style="color:#000">&gt;</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">pathname</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">parent</span><span style="color:#000">,</span> <span style="color:#000">String</span> <span style="color:#000">child</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">File</span> <span style="color:#000">parent</span><span style="color:#000">,</span> <span style="color:#000">String</span> <span style="color:#000">child</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Path-component accessors -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getName</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getParent</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span> <span style="color:#000">getParentFile</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getPath</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Path operations -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isAbsolute</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getAbsolutePath</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span> <span style="color:#000">getAbsoluteFile</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getCanonicalPath</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span> <span style="color:#000">getCanonicalFile</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Attribute accessors -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">canRead</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">canWrite</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">exists</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isDirectory</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isFile</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isHidden</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">lastModified</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">length</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span></code></pre></div></section><section>
<h2 id="classe-javaiofile-pt2">Classe <code>java.io.File</code>: pt2</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>    <span style="color:#177500">/* -- File operations -- */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">createNewFile</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">delete</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">deleteOnExit</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">list</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">list</span><span style="color:#000">(</span><span style="color:#000">FilenameFilter</span> <span style="color:#000">filter</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">mkdir</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">renameTo</span><span style="color:#000">(</span><span style="color:#000">File</span> <span style="color:#000">dest</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setLastModified</span><span style="color:#000">(</span><span style="color:#a90d91">long</span> <span style="color:#000">time</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setReadOnly</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setWritable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">writable</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">ownerOnly</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setWritable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">writable</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setReadable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">readable</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">ownerOnly</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setReadable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">readable</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setExecutable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">executable</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">ownerOnly</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setExecutable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">executable</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">canExecute</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Disk usage -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">getTotalSpace</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">getFreeSpace</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">getUsableSpace</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="javaiofile-in-azione-modella-un-path-su-file-system"><code>java.io.File</code> in azione (modella un path su File System)</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseFile</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">SEP</span> <span style="color:#000">=</span> <span style="color:#000">File</span><span style="color:#000">.</span><span style="color:#836c28">separator</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// public static final String FILE_NAME = "/home/mirko/aula/15/Prova.bin"; // non portabile!!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">FILE_NAME</span> <span style="color:#000">=</span> <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">getProperty</span><span style="color:#000">(</span><span style="color:#c41a16">"user.home"</span><span style="color:#000">)</span> <span style="color:#000">+</span> <span style="color:#000">SEP</span> <span style="color:#000">+</span> <span style="color:#c41a16">"aula"</span> <span style="color:#000">+</span> <span style="color:#000">SEP</span> <span style="color:#000">+</span> <span style="color:#c41a16">"15"</span> <span style="color:#000">+</span> <span style="color:#000">SEP</span> <span style="color:#000">+</span> <span style="color:#c41a16">"Prova.bin"</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#000">Iterable</span><span style="color:#000">&lt;</span><span style="color:#000">Method</span><span style="color:#000">&gt;</span> <span style="color:#000">accessors</span><span style="color:#000">(</span><span style="color:#000">Class</span><span style="color:#000">&lt;?&gt;</span> <span style="color:#000">c</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">Collection</span><span style="color:#000">&lt;</span><span style="color:#000">Method</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">Method</span> <span style="color:#000">m</span> <span style="color:#000">:</span> <span style="color:#000">c</span><span style="color:#000">.</span><span style="color:#836c28">getMethods</span><span style="color:#000">())</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#000">m</span><span style="color:#000">.</span><span style="color:#836c28">getParameterTypes</span><span style="color:#000">().</span><span style="color:#836c28">length</span> <span style="color:#000">==</span> <span style="color:#000">0</span>
</span></span><span style="display:flex;"><span>					<span style="color:#000">&amp;&amp;</span> <span style="color:#000">m</span><span style="color:#000">.</span><span style="color:#836c28">getName</span><span style="color:#000">().</span><span style="color:#836c28">matches</span><span style="color:#000">(</span><span style="color:#c41a16">"is.*|get.*|can.*"</span><span style="color:#000">))</span> <span style="color:#000">{</span> <span style="color:#177500">// REGEX
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">list</span><span style="color:#000">.</span><span style="color:#836c28">add</span><span style="color:#000">(</span><span style="color:#000">m</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">list</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">File</span> <span style="color:#000">f</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">File</span><span style="color:#000">(</span> <span style="color:#000">args</span><span style="color:#000">.</span><span style="color:#836c28">length</span> <span style="color:#000">==</span> <span style="color:#000">0</span> <span style="color:#000">?</span> <span style="color:#000">FILE_NAME</span> <span style="color:#000">:</span> <span style="color:#000">args</span><span style="color:#000">[</span><span style="color:#000">0</span><span style="color:#000">]);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">Method</span> <span style="color:#000">m</span> <span style="color:#000">:</span> <span style="color:#000">accessors</span><span style="color:#000">(</span><span style="color:#000">File</span><span style="color:#000">.</span><span style="color:#836c28">class</span><span style="color:#000">))</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">m</span><span style="color:#000">.</span><span style="color:#836c28">getName</span><span style="color:#000">()</span> <span style="color:#000">+</span> <span style="color:#c41a16">" "</span> <span style="color:#000">+</span> <span style="color:#000">m</span><span style="color:#000">.</span><span style="color:#836c28">invoke</span><span style="color:#000">(</span><span style="color:#000">f</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// REGEX: http://docs.oracle.com/javase/tutorial/essential/regex/
</span></span></span></code></pre></div></section><section>
<p>frametitle{Esempio di output}
\begin{lstlisting}[basicstyle=\ssmall\ttfamily]
getName prova.bin
getParent /home/mirko/aula/15
isAbsolute true
getCanonicalPath /home/mirko/aula/15/prova.bin
getPath /home/mirko/aula/15/prova.bin
getParentFile /home/mirko/aula/15
getAbsolutePath /home/mirko/aula/15/prova.bin
getAbsoluteFile /home/mirko/aula/15/prova.bin
getCanonicalFile /home/mirko/aula/15/prova.bin
canRead true
canWrite true
isDirectory false
isFile true
isHidden false
canExecute false
getTotalSpace 53616242688
getFreeSpace 14087458816
getUsableSpace 11357081600
getClass class java.io.File
\end{lstlisting}</p>
</section><section>
<h2 id="accedere-al-contenuto-di-un-file">Accedere al contenuto di un file</h2>
<h3 id="come-fare">Come fare?</h3>
<pre><code>*  Un file ha un contenuto informativo (potenzialmente di grosse dimensioni)
*  Lo si potrebbe leggere (in vari modi)
*  Lo si potrebbe scrivere (in vari modi)
*  Il suo contenuto potrebbe essere interpretabile in vari modi
</code></pre>
<h3 id="alcuni-di-tali-concetti-sono-condivisi-con-altri-meccanismi">Alcuni di tali concetti sono condivisi con altri meccanismi</h3>
<pre><code>*  Risorse interne al classpath Java
*  Networking e file di rete
*  Archivi su database
*  Depositi di informazione in memoria





Il concetto di *__input/output-stream__* è usato come astrazione unificante
</code></pre>
</section><section>
<h1 id="inputoutputstream">Input/OutputStream</h1>
</section><section>
<h2 id="overview-sugli-inputstream-e-outputstream-in-java">Overview sugli <code>InputStream</code> e <code>OutputStream</code> in Java</h2>
<h3 id="inputstream-e-outputstream"><code>InputStream</code> e <code>OutputStream</code></h3>
<pre><code>*  Stream = flusso (di dati)
*  Di base, gestiscono flussi binari (di `byte`) leggibili vs. scrivibili 
*  Sono classi astratte (e non interfacce..)
*  Possono essere specializzate da "sottoclassi" e "decorazioni", tra cui{

    *  Per diverse sorgenti e destinazioni di informazione, ad esempio su file (`FileInputStream`) o su memoria (`ByteArrayInputStream`)
    *  Per diversi formati di informazione, ad esempio valori primitivi (`DataInputStream`) o interi oggetti Java (`ObjectInputStream`)
    \item[$\Rightarrow$]..e corrispondenti versioni `Output`
</code></pre>
<p>}</p>
<h3 id="tipicamente-usati-per-alimentare-altre-classi">Tipicamente usati per alimentare altre classi</h3>
<pre><code>*  File di testo (`Reader`, `Writer`, e specializzazioni)

*  Librerie avanzate comunemente usate per l'accesso al file system tipicamente hanno metodi che accettano (`In`/`Out`)`putStream`
</code></pre>
</section><section>
<h2 id="la-classe-javaioinputstream">La classe <code>java.io.InputStream</code></h2>
<pre><code>\sizedcode{\scriptsize}{code/io/InputStream.java}
</code></pre>
</section><section>
<h2 id="fileinputstream-e-bytearrayinputstream"><code>FileInputStream</code> e <code>ByteArrayInputStream</code></h2>
<pre><code>![](img/bytefile.png)
</code></pre>
</section><section>
<h2 id="uso-di-bytearrayinputstream">Uso di <code>ByteArrayInputStream</code></h2>
<h3 id="bytearrayinputstream"><code>ByteArrayInputStream</code></h3>
<pre><code>  *  crea un `InputStream` a partire da un `byte[]`
  *  è un wrapper
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseByteArrayStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">,</span> <span style="color:#000">40</span><span style="color:#000">,</span> <span style="color:#000">-</span><span style="color:#000">58</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ByteArrayInputStream</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">int</span> <span style="color:#000">c</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">while</span> <span style="color:#000">((</span><span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">())</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">)</span> <span style="color:#000">{</span> <span style="color:#177500">// C-style
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">c</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span> <span style="color:#a90d91">finally</span> <span style="color:#000">{</span> <span style="color:#177500">// assicura la chiusura anche con eccezioni
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">close</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="il-costrutto-try-with-resources">Il costrutto <code>try-with-resources</code></h2>
<h3 id="costrutto-try-with-resources">Costrutto <code>try-with-resources</code></h3>
<pre><code>  *  vuole la creazione di un `java.lang.AutoCloseable` come primo argomento
  *  ne assicura la chiusura 
  *  si possono opzionalmente aggiungere delle `catch` di eccezioni
  *  andrebbe sempre usato..
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseTryWithResources</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">30</span><span style="color:#000">,</span> <span style="color:#000">40</span><span style="color:#000">,</span> <span style="color:#000">50</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">int</span> <span style="color:#000">c</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ByteArrayInputStream</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">))</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">while</span> <span style="color:#000">((</span><span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">())</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">)</span> <span style="color:#000">{</span> <span style="color:#177500">// C-style
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">c</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="esempio-streamdumper">Esempio <code>StreamDumper</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">StreamDumper</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// rendo inaccessibile il costruttore
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">private</span> <span style="color:#000">StreamDumper</span><span style="color:#000">()</span> <span style="color:#000">{}</span>
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">dump</span><span style="color:#000">(</span><span style="color:#000">InputStream</span> <span style="color:#000">input</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">c</span><span style="color:#000">=</span><span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">(</span><span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">input</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">())</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">;)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">print</span><span style="color:#000">(</span><span style="color:#000">c</span><span style="color:#000">+</span><span style="color:#c41a16">"\t"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usestreamdumper----uso-uniforme-di-vari-inputstream"><code>UseStreamDumper</code> – uso uniforme di vari <code>InputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseStreamDumper</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]{</span><span style="color:#000">10</span><span style="color:#000">,</span><span style="color:#000">20</span><span style="color:#000">,</span><span style="color:#000">30</span><span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">input</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ByteArrayInputStream</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">input2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">input3</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">InputStream</span><span style="color:#000">(){</span> <span style="color:#177500">// An ad-hoc stream
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#a90d91">private</span> <span style="color:#a90d91">int</span> <span style="color:#000">count</span> <span style="color:#000">=</span> <span style="color:#000">100</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#000">Random</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Random</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">read</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">return</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">count</span><span style="color:#000">--</span> <span style="color:#000">&gt;</span> <span style="color:#000">0</span> <span style="color:#000">?</span> <span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">nextInt</span><span style="color:#000">(</span><span style="color:#000">256</span><span style="color:#000">)</span> <span style="color:#000">:</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">StreamDumper</span><span style="color:#000">.</span><span style="color:#836c28">dump</span><span style="color:#000">(</span><span style="color:#000">input</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">StreamDumper</span><span style="color:#000">.</span><span style="color:#836c28">dump</span><span style="color:#000">(</span><span style="color:#000">input2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">StreamDumper</span><span style="color:#000">.</span><span style="color:#836c28">dump</span><span style="color:#000">(</span><span style="color:#000">input3</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="la-classe-javaiooutputstream">La classe <code>java.io.OutputStream</code></h2>
<pre><code>\sizedcode{\scriptsize}{code/io/OutputStream.java}
</code></pre>
<h3 id="stream-di-uscita----duale-allinputstream">Stream di uscita – Duale all’<code>InputStream</code></h3>
<pre><code>*  Esistono anche le analoghe specializzazioni `ByteArrayOutputStream` e `FileOutputStream`
</code></pre>
</section><section>
<h2 id="useoutputstream"><code>UseOutputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Random</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseOutputStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">output</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#177500">// Aggiungo byte random
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#a90d91">final</span> <span style="color:#000">Random</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Random</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">100</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">nextInt</span><span style="color:#000">(</span><span style="color:#000">256</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#177500">// Aggiungo un array di byte
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">30</span><span style="color:#000">,</span> <span style="color:#000">40</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">10</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="useoutputstream2----qualche-variante"><code>UseOutputStream2</code> – qualche variante</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Random</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// Due varianti: uso di java.io.File, e catch con try-with-resources
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseOutputStream2</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">output</span> <span style="color:#000">=</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#177500">// Aggiungo byte random
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#a90d91">final</span> <span style="color:#000">Random</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Random</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">100</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">nextInt</span><span style="color:#000">(</span><span style="color:#000">256</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#177500">// Aggiungo un array di byte
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">30</span><span style="color:#000">,</span> <span style="color:#000">40</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">10</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span> <span style="color:#a90d91">catch</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">IOException</span> <span style="color:#000">e</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Something went wrong!"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="salvataggio-di-strutture-dati-listbyte">Salvataggio di strutture dati: <code>List&lt;Byte&gt;</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">ListOnFile</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Byte</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;(</span><span style="color:#000">20</span><span style="color:#000">);</span> <span style="color:#177500">// Creo una lista random
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">ar</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[</span><span style="color:#000">20</span><span style="color:#000">];</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">new</span> <span style="color:#000">Random</span><span style="color:#000">().</span><span style="color:#836c28">nextBytes</span><span style="color:#000">(</span><span style="color:#000">ar</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span> <span style="color:#000">b</span> <span style="color:#000">:</span> <span style="color:#000">ar</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">list</span><span style="color:#000">.</span><span style="color:#836c28">add</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Prima: "</span> <span style="color:#000">+</span> <span style="color:#000">list</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span> <span style="color:#000">b</span> <span style="color:#000">:</span> <span style="color:#000">list</span><span style="color:#000">)</span> <span style="color:#000">{</span> <span style="color:#177500">// La riverso su file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">file</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Byte</span><span style="color:#000">&gt;</span> <span style="color:#000">list2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">int</span> <span style="color:#000">c</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">while</span> <span style="color:#000">((</span><span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">file2</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">())</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">)</span> <span style="color:#000">{</span> <span style="color:#177500">// Ricarico da file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">list2</span><span style="color:#000">.</span><span style="color:#836c28">add</span><span style="color:#000">((</span><span style="color:#a90d91">byte</span><span style="color:#000">)</span> <span style="color:#000">c</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Dopo: "</span> <span style="color:#000">+</span> <span style="color:#000">list2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="solo-byte">Solo <code>byte</code>?</h2>
<h3 id="problema">Problema…</h3>
<pre><code>*  Poter leggere e scrivere da uno `Stream` anche `int`, `long`, eccetera

%*  Nel caso nuove esigenze simili si debbano creare, non devono esserci interferenze o esplosione di classi
</code></pre>
<h3 id="il-concetto-di-decoratore">Il concetto di decoratore</h3>
<pre><code>*  Si definisce `DataInputStream` che estende `InputStream`{

    *  e similmente `DataOutputStream` che estende `OutputStream`
</code></pre>
<p>}
*  Tale nuova classe comunque fa da wrapper per un <code>InputStream</code>, al quale delega le varie operazioni
*  Un oggetto di tale nuova classe è un decoratore per quello interno.. visto che ne modifica il funzionamento
*  Con questa tecnica è possibile decorare sia un <code>FileInputStream</code> che un <code>ByteArrayInputStream</code> – o altri</p>
</section><section>
<h2 id="decorazione-in-generale">Decorazione, in generale</h2>
<pre><code>![](img/decorator.png)
</code></pre>
</section><section>
<h2 id="decorazione-il-caso-di-datainputstream">Decorazione, il caso di <code>DataInputStream</code></h2>
<pre><code>![](img/dec.png)
</code></pre>
</section><section>
<h2 id="datainputstream"><code>DataInputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">interface</span> <span style="color:#3f6e75">DataInput</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">readFully</span><span style="color:#000">(</span><span style="color:#a90d91">byte</span> <span style="color:#000">b</span><span style="color:#000">[])</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">boolean</span> <span style="color:#000">readBoolean</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">byte</span> <span style="color:#000">readByte</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">int</span> <span style="color:#000">readUnsignedByte</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">short</span> <span style="color:#000">readShort</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">int</span> <span style="color:#000">readUnsignedShort</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">char</span> <span style="color:#000">readChar</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">int</span> <span style="color:#000">readInt</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">long</span> <span style="color:#000">readLong</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">float</span> <span style="color:#000">readFloat</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">double</span> <span style="color:#000">readDouble</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000">String</span> <span style="color:#000">readUTF</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span> <span style="color:#177500">// non-standard UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>     <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">FilterInputStream</span> <span style="color:#a90d91">extends</span> <span style="color:#000">InputStream</span><span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">DataInputStream</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">extends</span> <span style="color:#000">FilterInputStream</span> <span style="color:#a90d91">implements</span> <span style="color:#000">DataInput</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span><span style="color:#000">InputStream</span> <span style="color:#000">in</span><span style="color:#000">){...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="dataoutputstream"><code>DataOutputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">DataOutputStream</span> <span style="color:#a90d91">extends</span> <span style="color:#000">OutputStream</span> <span style="color:#000">...</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeByte</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeShort</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeChar</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeInt</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeLong</span><span style="color:#000">(</span><span style="color:#a90d91">long</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeFloat</span><span style="color:#000">(</span><span style="color:#a90d91">float</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeDouble</span><span style="color:#000">(</span><span style="color:#a90d91">double</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeBytes</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">s</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeChars</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">s</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeUTF</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">str</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span> <span style="color:#177500">// non-standard UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">FilterOutputStream</span> <span style="color:#a90d91">extends</span> <span style="color:#000">OutputStream</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">DataOutputStream</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">extends</span> <span style="color:#000">FilterOutputStream</span> <span style="color:#a90d91">implements</span> <span style="color:#000">DataOutput</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span><span style="color:#000">OutputStream</span> <span style="color:#000">out</span><span style="color:#000">)</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usedatastream"><code>UseDataStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseDataStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataOutputStream</span> <span style="color:#000">dstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">true</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeUTF</span><span style="color:#000">(</span><span style="color:#c41a16">"Ciao"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataInputStream</span> <span style="color:#000">dstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span><span style="color:#000">file2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readBoolean</span><span style="color:#000">());</span> <span style="color:#177500">// Do not change order
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readUTF</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="altra-decorazione-bufferedinputstream-bufferedoutputstream">Altra decorazione: <code>BufferedInputStream</code>, <code>BufferedOutputStream</code></h2>
<h3 id="esigenza">Esigenza</h3>
<pre><code>*  fornire una diversa implementazione interna dello stream
*  non legge un byte alla volta, ma riempie un buffer
*  questo aumenta le performance nell'accesso a file e rete
*  come fornire la funzionalità in modo ortogonale al resto della gestione degli stream?
</code></pre>
<h3 id="bufferedinputstream-bufferedoutputstream"><code>BufferedInputStream</code>, <code>BufferedOutputStream</code></h3>
<pre><code>*  sono ulteriori decoratori, della stessa forma dei precedenti
*  non aggiungono altri metodi
*  per come sono fatti i decoratori, possono essere usati in "cascata" a `DataInputStream` e `DataOutputStream`
</code></pre>
</section><section>
<h2 id="usebuffereddatastream"><code>UseBufferedDataStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseBufferedDataStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream -&gt; bstream -&gt; file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">bstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedOutputStream</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataOutputStream</span> <span style="color:#000">dstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span><span style="color:#000">bstream</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">true</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeUTF</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span> <span style="color:#177500">// Scrive in rappresentazione UTF-16
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream2 -&gt; bstream2 -&gt; file2
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">bstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedInputStream</span><span style="color:#000">(</span><span style="color:#000">file2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataInputStream</span> <span style="color:#000">dstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span><span style="color:#000">bstream2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readBoolean</span><span style="color:#000">());</span> <span style="color:#177500">// Do not change order!!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readUTF</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usebuffereddatastream2----chaining-dei-costruttori"><code>UseBufferedDataStream2</code> – chaining dei costruttori</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseBufferedDataStream2</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream -&gt; bstream -&gt; file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataOutputStream</span> <span style="color:#000">dstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">BufferedOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">true</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeUTF</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span> <span style="color:#177500">// Scrive in rappresentazione UTF-16
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream2 -&gt; bstream2 -&gt; file2
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataInputStream</span> <span style="color:#000">dstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">BufferedInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readBoolean</span><span style="color:#000">());</span> <span style="color:#177500">// Do not change order!!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readUTF</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="decorazione-una-visione-complessiva">Decorazione, una visione complessiva</h2>
<pre><code>![](img/dec-all.png)
</code></pre>
</section><section>
<h2 id="altri-decoratori-di-inputstream-e-outputstream">Altri decoratori di <code>InputStream</code> (..e <code>OutputStream</code>)</h2>
<h3 id="sono-molteplici-tutti-usabili-in-combinazione">Sono molteplici, tutti usabili in combinazione</h3>
<pre><code>  *  `CheckedInputStream`: mantiene un "checksum" per verifica integrità
  *  `CipherInputStream`: legge dati poi processati dopo una cifratura
  *  `DeflateInputStream`: legge dati e li comprime in formato "deflate"
  *  `InflaterInputStream`: legge dati e li scompatta dal formato "deflate"
  *  `ProgressMonitorInputStream`: legge dati con possibilità di "unread"
</code></pre>
</section><section>
<h2 id="ancora-sui-decoratori">Ancora sui decoratori</h2>
<h3 id="pro-e-contro">Pro e contro</h3>
<pre><code>*  Sono un mix di polimorfismo e incapsulamento
*  Consentono di comporre funzionalità in modo piuttosto flessibile
*  Danno luogo a più flessibilità rispetto all'ereditarietà
*  Più complicati da usare e comprendere
</code></pre>
<h3 id="con-gli-stream-è-possibile-comporre">Con gli stream, è possibile comporre:</h3>
<pre><code>*  Uno stream di sorgente dati: `FileInputStream`, `ByteArrayInputStream`, ..
*  Uno (o più) stream di gestione interna: `BufferInputStream`, ..
*  Uno stream di presentazione dati: `DataInputStream`, `ObjectInputStream`, ..
</code></pre>
</section><section>
<p>\section[De/serializzazione]{De/Serializzazione di oggetti}</p>
<h2 id="file-ed-encoding">File ed encoding</h2>
<h3 id="il-contenuto-dei-file">Il contenuto dei file</h3>
<pre><code>  Supponiamo utilizziate un `DataOutputStream` per scrivere in sequenza i numeri da 0 a 20 (escluso)
    

        *  Che cosa avete realmente scritto?
        *  avete scritto i byte da zero a 19
        *  In esadecimale, `0x000102030405060708090A0B0C0D0E0F10111213`
        *  **Non** avete scritto il testo `012345678910111213141516171819`
    





    *  I file sono sequenze di byte
    *  Per fare input/output occorre stabilire:
    

      *  Una conversione dalla struttura dati che stiamo manipolando a sequenza di byte (encoding)
      *  Una conversione da sequenza di byte a struttura dati (decoding)
    

    *  I `Data-Stream` offrono encoding e decoding per tipi primitivi
    *  Come trattare strutture dati più articolate?
</code></pre>
</section><section>
<h2 id="serializzazione-di-oggetti">Serializzazione di oggetti</h2>
<h3 id="motivazioni">Motivazioni</h3>
<pre><code>*  Rendere gli oggetti persistenti, e trasferibili a istanze di JVM diverse
*  Esempio: memorizzarli su file, su array di byte, trasferirli via rete
*  Java Serialization{

    *  serializza con relativa semplicità strutture di oggetti anche complicate
    *  a volte è fondamentale apportarvi correzioni ad-hoc
</code></pre>
<p>}</p>
<h3 id="ingredienti-serialization">Ingredienti Serialization</h3>
<pre><code>    *  Interfaccia "tag" `java.io.Serializable`
    *  Classi `ObjectInputStream` e `ObjectOutputStream`
    *  Keyword `transient` per campi che non devono essere serializzati
    *  Metodi `readObject` e `writeObject` (e altri) per modificare la serializzazione di default per un oggetto, o per motivi di sicurezza
    *  Meccanismo `UID` per gestire versioni diverse delle classi
</code></pre>
</section><section>
<h2 id="diagramma-uml-con-objectinputstream">Diagramma UML con <code>ObjectInputStream</code></h2>
<pre><code>![](img/object.png)
</code></pre>
</section><section>
<h2 id="classe-person-e-linterfaccia-tag-serializable">Classe <code>Person</code> e l’interfaccia “tag” <code>Serializable</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Persona</span> <span style="color:#a90d91">implements</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">567742502623265945L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">Persona</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">,</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">,</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">=</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">=</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">+</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">?</span> <span style="color:#c41a16">"spos"</span> <span style="color:#000">:</span> <span style="color:#c41a16">"non-spos"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><h3 id="serializable----implementata-già-da-molte-classi-non-object"><code>Serializable</code> – implementata già da molte classi, non <code>Object</code></h3>
<pre><code>*  da implementare per avere oggetti "automaticamente" serializzabili
*  ciò non comporta alcun contratto da ottemperare
</code></pre>
</section><section>
<h2 id="classe-useobjectstream">Classe <code>UseObjectStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseObjectStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// ostream -&gt; bstream -&gt; file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">bstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedOutputStream</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">ostream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectOutputStream</span><span style="color:#000">(</span><span style="color:#000">bstream</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">util</span><span style="color:#000">.</span><span style="color:#836c28">Date</span><span style="color:#000">());</span> <span style="color:#177500">// Classe serializ.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">Persona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">,</span> <span style="color:#000">1960</span><span style="color:#000">,</span> <span style="color:#a90d91">false</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// ostream2 -&gt; bstream2 -&gt; file2
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">bstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedInputStream</span><span style="color:#000">(</span><span style="color:#000">file2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">ostream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectInputStream</span><span style="color:#000">(</span><span style="color:#000">bstream2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">());</span> <span style="color:#177500">// carica il Date
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">());</span> <span style="color:#177500">// carica la Persona
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="classe-useobjectstream-note">Classe <code>UseObjectStream</code>: note</h2>
<h3 id="note">Note</h3>
<pre><code>*  la `writeObject()`/`readObject()` fallisce se l'oggetto non è serializzabile{

  *  se la classe dell'oggetto non implementa `Serializable`
  *  la la classe dell'oggetto ha un campo che sia un oggetto non serializzabile
</code></pre>
<p>}
*  la <code>readObject()</code> fallisce se la classe dell’oggetto non è disponibile
*  la <code>readObject()</code> fallisce se la classe dell’oggetto è una versione diversa</p>
</section><section>
<h2 id="come-funzionano-writeobjectreadobject">Come funzionano <code>writeObject()</code>/<code>readObject()</code></h2>
<h3 id="objectoutputstreamwriteobject"><code>ObjectOutputStream.writeObject()</code></h3>
<pre><code>*  Lancia una eccezione se l'oggetto non è serializzabile
*  Scrive sullo stream i campi dell'oggetto uno a uno &lt;br&gt; (di tipi primitivi o serializzabili a loro volta)
*  Si evitano i campi con modificatore `transient`
*  In questo processo, si evita di scrivere due volte uno stesso oggetto
</code></pre>
<h3 id="objectinputstreamreadobject"><code>ObjectInputStream.readObject()</code></h3>
<pre><code>*  Lancia una eccezione se non trova la classe o non è *__compatibile__*
*  Chiama il costruttore senza argomenti della prima sopra-classe non serializzabile, e da lì in giù non chiama altri costruttori
*  Ripristina il valore dei campi leggendoli dallo stream
*  Lascia inalterati i campi `transient`
</code></pre>
</section><section>
<h2 id="il-problema-delle-versioni-di-una-classe-serialversionuid">Il problema delle versioni di una classe: <code>serialVersionUID</code></h2>
<h3 id="problema-1">Problema</h3>
<pre><code>*  Si serializza un oggetto, la classe viene modificata e ricompilata, e quindi si ritira su l'oggetto..  i dati sarebbero facilmente "corrupted"
</code></pre>
<h3 id="soluzione-ogni-classe-che-implementa-serializable">Soluzione: ogni classe che implementa <code>Serializable</code>…</h3>
<pre><code>*  .. deve fornire una costante "`long serialVersionUID`" che contiene un numero univoco per quella versione della classe
*  Se non corrisponde a quello dell'oggetto caricato si ha eccezione
</code></pre>
<h3 id="fatti">Fatti</h3>
<pre><code>*  Se mancante Eclipse segnala warning. Può generarne uno a richiesta.
*  Se mancante la JVM ne calcola uno suo ma è sconsigliato.
*  Molti lasciano il campo al valore $1$, non preoccupandosene.
</code></pre>
</section><section>
<h2 id="i-campi-transient">I campi <code>transient</code></h2>
<h3 id="i-campi-transient-non-vengono-serializzati-in-quali-casi-servono">I campi <code>transient</code> non vengono serializzati. In quali casi servono?</h3>
<pre><code>*  Campi aggiunti per motivi di performance (p.e., caching di un calcolo), e che quindi possono essere ricostruiti a partire dagli altri campi
*  Campi che contengono info specifiche sul run corrente della JVM (p.e., logs), e che quindi non avrebbero più senso quando l'oggetto viene recuperato dallo stream
*  Campi che contengono oggetti comunque non serializzabili (p.e., `Object`), e che quindi porterebbero ad una eccezione
*  Campi per i quali si vuole prevedere un meccanismo di serializzazione diverso
</code></pre>
</section><section>
<h2 id="cpersona-con-caching-tostring-pt1"><code>CPersona</code> con caching <code>toString</code>, pt1</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">CPersona</span> <span style="color:#a90d91">implements</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// Generated by Eclipse
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">8985026380526620812L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">transient</span> <span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">CPersona</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">,</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">=</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">=</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getNome</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">getAnnoNascita</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isSposato</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="cpersona-con-caching-tostring-pt2"><code>CPersona</code> con caching <code>toString</code>, pt2</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">setAnnoNascita</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">=</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">setSposato</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">=</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">computeToString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">+</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">?</span> <span style="color:#c41a16">"spos"</span> <span style="color:#000">:</span> <span style="color:#c41a16">"non-spos"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">err</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Log: The cache is empty..."</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">computeToString</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usetransient"><code>UseTransient</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseTransient</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">out</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">CPersona</span> <span style="color:#000">p</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">CPersona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">,</span> <span style="color:#000">1960</span><span style="color:#000">,</span> <span style="color:#a90d91">false</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Prima stampa "</span> <span style="color:#000">+</span> <span style="color:#000">p</span><span style="color:#000">);</span> <span style="color:#177500">// cache vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Seconda stampa "</span> <span style="color:#000">+</span> <span style="color:#000">p</span><span style="color:#000">);</span> <span style="color:#177500">// cache non vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">out</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">CPersona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">,</span> <span style="color:#000">1960</span><span style="color:#000">,</span> <span style="color:#a90d91">false</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Ri-carico l'oggetto... "</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">CPersona</span> <span style="color:#000">q</span> <span style="color:#000">=</span> <span style="color:#000">(</span><span style="color:#000">CPersona</span><span style="color:#000">)</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">();</span> <span style="color:#177500">//attenzione al cast!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Prima stampa "</span> <span style="color:#000">+</span> <span style="color:#000">q</span><span style="color:#000">);</span> <span style="color:#177500">// cache vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Seconda stampa "</span> <span style="color:#000">+</span> <span style="color:#000">q</span><span style="color:#000">);</span> <span style="color:#177500">// cache non vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="progettazione-di-una-serializzazione-ad-hoc">Progettazione di una serializzazione ad-hoc</h2>
<h3 id="serializzazione-ad-hoc">Serializzazione ad-hoc</h3>
<pre><code>*  Il modello transient/non-transient a volte non è sufficiente
*  A volte serve serializzare in modo diverso certi campi
*  È possibile definire per la classe serializzabile i metodi "`void readObject(ObjectInputStream in)`" e "`void writeObject(ObjectOutputStream out)`"
*  Se definiti, `ObjectInputStream` e `ObjectOutputStream` chiamano quelli
</code></pre>
<h3 id="dettagli">Dettagli</h3>
<pre><code>*  Tali metodi possono cominciare con la chiamata a `defaultReadObject()`/`defaultWriteObject()`, per leggere i campi non-statici e non-transienti
*  Si può quindi proseguire scrivendo/leggendo negli stream in input quello che si vuole
</code></pre>
</section><section>
<h2 id="apersona-serializzazione-ad-hoc-per-una-data"><code>APersona</code>: serializzazione ad-hoc per una data</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">APersona</span> <span style="color:#a90d91">implements</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">8985026380526620812L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">transient</span> <span style="color:#000">Date</span> <span style="color:#000">lastUse</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Date</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">APersona</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">used</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Date</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">+</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span> <span style="color:#000">?</span> <span style="color:#c41a16">"null"</span> <span style="color:#000">:</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span><span style="color:#000">.</span><span style="color:#836c28">getTime</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">out</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">out</span><span style="color:#000">.</span><span style="color:#836c28">defaultWriteObject</span><span style="color:#000">();</span> <span style="color:#177500">// accetto il comportamento di default
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">err</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"writing"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// una sorta di costruttore..
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">readObject</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">in</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span><span style="color:#000">,</span> <span style="color:#000">ClassNotFoundException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">defaultReadObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">err</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"reading"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Date</span><span style="color:#000">();</span> <span style="color:#177500">// in lettura, ripristino la data corrente
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="useadhocserialization"><code>UseAdHocSerialization</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">it.unibo.io.files.UseFile</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseAdHocSerialization</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">out</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">APersona</span> <span style="color:#000">p</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">APersona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">p</span><span style="color:#000">.</span><span style="color:#836c28">used</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">p</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">out</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#000">p</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Ri-carico l'oggetto... "</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">APersona</span> <span style="color:#000">q</span> <span style="color:#000">=</span> <span style="color:#000">(</span><span style="color:#000">APersona</span><span style="color:#000">)</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">q</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="serializzazione-ad-hoc-per-javautilarraylist-pt1">Serializzazione ad-hoc per <code>java.util.ArrayList</code>, pt1</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">java.util</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">ArrayList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#a90d91">extends</span> <span style="color:#000">AbstractList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">implements</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;,</span> <span style="color:#000">RandomAccess</span><span style="color:#000">,</span> <span style="color:#000">Cloneable</span><span style="color:#000">,</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span>
</span></span><span style="display:flex;"><span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">8683452581122892189L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">transient</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">writeObject</span><span style="color:#000">(</span><span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">ObjectOutputStream</span> <span style="color:#000">s</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throws</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">IOException</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Write out element count, and any hidden stuff
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">defaultWriteObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Write out array length
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">elementData</span><span style="color:#000">.</span><span style="color:#836c28">length</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Write out all elements in the proper order.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">&lt;</span><span style="color:#000">size</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="serializzazione-ad-hoc-per-javautilarraylist-pt2">Serializzazione ad-hoc per <code>java.util.ArrayList</code>, pt2</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">readObject</span><span style="color:#000">(</span><span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">ObjectInputStream</span> <span style="color:#000">s</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throws</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">IOException</span><span style="color:#000">,</span> <span style="color:#000">ClassNotFoundException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Read in size, and any hidden stuff
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">defaultReadObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Read in array length and allocate array
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">int</span> <span style="color:#000">arrayLength</span> <span style="color:#000">=</span> <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span><span style="color:#000">[</span><span style="color:#000">arrayLength</span><span style="color:#000">];</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Read in all elements in the proper order.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">&lt;</span><span style="color:#000">size</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">a</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></div></section><section>
<h2 id="note-sulla-serializzazione-java">Note sulla serializzazione Java</h2>
<h3 id="raramente-utilizzata-in-applicazioni-vere">Raramente utilizzata in applicazioni “vere”</h3>
<pre><code>    Applicazioni vere tendono a non utilizzare `Object`(`In`/`Out`)`putStream`:
    

        *  Nessuna standardizzazione
        *  Poco efficiente in termini di spazio
        *  Dispendiosa in termini di performance
        *  Scarsa portabilità (solo da/a software Java)
        *  `readObject` / `writeObject` in qualche modo violano il linguaggio
</code></pre>
<h3 id="importanza-di-serializable">Importanza di <code>Serializable</code></h3>
<pre><code>    Approcci diversi alla serializzazione spesso:
    

        *  Serializzano oggetti `Serializable` con campi `Serializable` e non `transient` (deve valere ricorsivamente)
        *  Prevedono sistemi custom per la serializzazione di oggetti diversi
        *  Non fanno uso di `readObject` / `writeObject`
</code></pre>
</section><section>
<h1 id="randomaccessfile">`RandomAccessFile</h1>
</section><section>
<p>`</p>
<h2 id="classe-randomaccessfile">Classe <code>RandomAccessFile</code></h2>
<h3 id="motivazioni-1">Motivazioni</h3>
<pre><code>*  Alcuni file sono di grosse dimensioni, e non vengo letti/scritti per intero come nei casi visti finora
*  Bensì si modifica qualche elemento "a metà", o se ne aggiungono in fondo, o si legge un elemento in una data posizione
</code></pre>
<h3 id="classe-randomaccessfile-1">Classe <code>RandomAccessFile</code></h3>
<pre><code>*  Non è usata tramite `InputStream` o `OutputStream`
*  Fornisce i metodi di `DataInput` e `DataOutput`
*  Fornisce metodi aggiuntivi:{

    *  `getFilePointer`: torna la posizione corrente nel file
    *  `seek`: imposta la nuova posizione nel file
    *  `length`: torna la lunghezza del file
    *  `setLength`: imposta la lunghezza del file
</code></pre>
<p>}</p>
</section><section>
<h2 id="classe-randomaccessfile-2">Classe <code>RandomAccessFile</code></h2>
<pre><code>![](img/random.png)
</code></pre>
</section><section>
<h2 id="userandomaccessfile"><code>UseRandomAccessFile</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseRandomAccessFile</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">RandomAccessFile</span> <span style="color:#000">raf</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">RandomAccessFile</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">,</span> <span style="color:#c41a16">"rw"</span><span style="color:#000">))</span> <span style="color:#000">{</span> <span style="color:#177500">// read-write
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">100000</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"writing: "</span> <span style="color:#000">+</span> <span style="color:#000">i</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">i</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">seek</span><span style="color:#000">(</span><span style="color:#000">23000</span> <span style="color:#000">*</span> <span style="color:#000">4</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"reading in position 23000*4: "</span> <span style="color:#000">+</span> <span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">setLength</span><span style="color:#000">(</span><span style="color:#000">800000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"extending the size"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">seek</span><span style="color:#000">(</span><span style="color:#000">123000</span> <span style="color:#000">*</span> <span style="color:#000">4</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"reading in position 123000*4: "</span> <span style="color:#000">+</span> <span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h1 id="file-di-testo">File di testo</h1>
</section><section>
<h2 id="limitazione-degli-stream-binari-visti-finora">Limitazione degli stream binari visti finora</h2>
<p>Finora abbiamo visto stream binari, ed in particolare di oggetti Java</p>
<pre><code>*  Non esiste uno standard documentato


  *  Gli standard descrivono in modo inequivoco un protocollo (in questo caso di de/serializzazione)
  *  Difficile scrivere librerie per leggere e scrivere in quel formato
  *  Bassa **standardizzazione**


*  Non comprensibili da applicazioni non-Java


  *  Oggetti serializzati non apribili da applicazioni in Javascript, Python, eccetera
  *  Non adatti e.g., per applicazioni web
  *  Bassa **portabilità**


*  Non comprensibili se aperti in formato testuale


  *  Non modificabili da umani
  *  Non adatti e.g., per file di configurazione
  *  Bassa **leggibilità** e quindi **intelligibilità**
</code></pre>
</section><section>
<h2 id="limitazione-degli-stream-binari-visti">Limitazione degli stream binari visti</h2>
<h3 id="standardizzazione-e-portabilità">Standardizzazione e portabilità</h3>
<pre><code>  *  Non direttamente ascrivibili al formato binario
  *  (che comunque non aiuta...)
  *  Esistono standard portabili binari, come ProtocolBuffers
</code></pre>
<h3 id="leggibilità-e-intelligibilità">Leggibilità e intelligibilità</h3>
<pre><code>  *  Problema comune a tutti i meccanismi finora visti
  *  Esistono standard per scrivere oggetti in formato testuale
  *  Problema da risolvere in due fasi:
  

    *  Conversione da oggetto a stringa di testo e viceversa
    *  Conversione da stringa di testo a file e viceversa
</code></pre>
</section><section>
<h2 id="conversione-da-oggetto-a-stringa-di-testo-e-viceversa">Conversione da oggetto a stringa di testo e viceversa</h2>
<pre><code>*  Banale nel caso in cui l'oggetto sia una stringa
*  Molto più complicato per strutture dati arbitrarie
*  Passo necessario verso l'interoperabilità fra linguaggi
</code></pre>
<h3 id="alcuni-formati-standard-per-la-conversione-di-oggetti-in-testo">(Alcuni) Formati standard per la conversione di oggetti in testo</h3>
<pre><code>  *  JavaScript Object Notation -- JSON (RFC 7159)
  

    *  Nato in seno a JavaScript (che non c'entra nulla con Java)
    *  Molto usato nel web
  

  *  Tom's Obvious, Minimal Language -- TOML
  

    *  Particolarmente indicato per file di configurazione
  

  *  YAML Ain't Markup Language -- YAML
  

    *  Superset di JSON dalla versione 1.2
    *  Supporto per funzioni avanzate (e.g. anchoring)
    *  Molto usato per file di configurazione complessi
</code></pre>
</section><section>
<h2 id="conversione-stringa-a-file-di-testo">Conversione stringa a file di testo</h2>
<p>Problema risolto con tabelle di conversione (text encoding)</p>
<p>Nota: importante anche per la rappr. <strong>in memoria</strong> dei caratteri</p>
<h3 id="text-encoding">Text Encoding</h3>
<pre><code>    *  ASCII (RFC 20)
    

      *  l'encoding che usa il linguaggio C per i `char`
      *  1 byte per carattere (massimo 256 caratteri)
    

    *  UTF-8 (RFC 3629)
    

      *  Standard di fatto sul web, encoding di default in Linux
      *  encoding da usare per i sorgenti di codice
      *  da 1 a 4 byte per carattere
      *  Codifica 1.112.064 simboli
    

    *  UTF-16 (RFC 2781)
    

      *  Encoding in memoria delle `String` in Java
      *  2 o 4 byte per carattere
      *  Codifica 1.112.064 simboli
    

    *  ISO Latin (ISO/IEC 8859-1:1998)
    

      *  Encoding di default del testo in Windows
</code></pre>
</section><section>
<h2 id="file-di-testo-1">File di testo</h2>
<h3 id="file-binari-vs-file-di-testo">File binari vs file di testo</h3>
<pre><code>*  Gli stream binari sono quelli visti, sono costituiti da sequenze di byte e il modo col quale si ottengono da questi altri tipi primitivi è standard
*  Gli "stream di testo" hanno problematiche diverse:{

    *  sono sequenze di caratteri
    *  la codifica (UTF-8, UTF-16, ASCII) potrebbe variare 
    *  la codifica potrebbe dettare anche i codici speciali di "a capo" etc.
</code></pre>
<p>}
*  Questa gestione richiede classi specifiche</p>
<h3 id="reader-e-writer"><code>Reader</code> (e <code>Writer)</code></h3>
<pre><code>*  `Reader`: la radice, con metodi per leggere caratteri, e linee di testo
*  `StringReader`: decoratore per prelevare da `String`
*  `BufferedReader`: decoratore per ottimizzare gli accessi
*  `InputStreamReader`: decoratore che incapsula un `InputStream`
*  `FileReader`: sua estensione per leggere da file via `FileInputStream`
</code></pre>
</section><section>
<h2 id="uml-classi-relative-ai-reader-writer-analoghi">UML classi relative ai reader (writer analoghi)</h2>
<pre><code>![](img/text.png)
</code></pre>
</section><section>
<h2 id="esempio-usereaderswriters">Esempio: <code>UseReadersWriters</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseReadersWriters</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">FILE_NAME</span> <span style="color:#000">=</span> <span style="color:#c41a16">"/home/mirko/aula/oop/15/a.txt"</span><span style="color:#000">;</span> <span style="color:#177500">// TODO: fix path
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">BufferedWriter</span> <span style="color:#000">w</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedWriter</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">FileWriter</span><span style="color:#000">(</span><span style="color:#000">FILE_NAME</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"di file"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">FileReader</span><span style="color:#000">(</span><span style="color:#000">FILE_NAME</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span> <span style="color:#177500">// null, indica la fine del file!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">FileReader</span><span style="color:#000">(</span><span style="color:#000">FILE_NAME</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#000">String</span> <span style="color:#000">line</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#a90d91">while</span><span style="color:#000">(</span> <span style="color:#000">(</span><span style="color:#000">line</span> <span style="color:#000">=</span> <span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">())</span> <span style="color:#000">!=</span> <span style="color:#a90d91">null</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>		        <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">line</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="esempio-usestreamreaderswriters">Esempio: <code>UseStreamReadersWriters</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#177500">// Soluzione con specifica della codifica dei caratteri
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseStreamReadersWriters</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">BufferedWriter</span> <span style="color:#000">w</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedWriter</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">OutputStreamWriter</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseReadersWriters</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">),</span><span style="color:#c41a16">"UTF-16"</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"di file"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">InputStreamReader</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseReadersWriters</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">),</span><span style="color:#c41a16">"UTF-16"</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span> <span style="color:#177500">// null
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>	
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="il-caso-di-systemin-e-systemout">Il caso di: <code>System.in</code> e <code>System.out</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">SystemInOut</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">is</span> <span style="color:#000">=</span> <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">in</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">br</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">InputStreamReader</span><span style="color:#000">(</span><span style="color:#000">is</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">br</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span> <span style="color:#177500">// può lanciare una IOException
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">PrintStream</span> <span style="color:#000">ps</span> <span style="color:#000">=</span> <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">;</span> 
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// una sotto-classe di OutputStream, che incapsula un Writer
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">ps</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Un comando noto"</span><span style="color:#000">);</span> <span style="color:#177500">// non lancia eccezioni!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">ps</span><span style="color:#000">.</span><span style="color:#836c28">format</span><span style="color:#000">(</span><span style="color:#c41a16">"Altro comando noto.. %d %f %s\n"</span><span style="color:#000">,</span> <span style="color:#000">10</span><span style="color:#000">,</span><span style="color:#000">20</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">,</span><span style="color:#c41a16">"prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// scrittura di file con PrintStream
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">final</span> <span style="color:#000">PrintStream</span> <span style="color:#000">ps2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">PrintStream</span><span style="color:#000">(</span><span style="color:#000">UseReadersWriters</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">print</span><span style="color:#000">(</span><span style="color:#000">10</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">close</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="riassunto-classi">Riassunto classi</h2>
<h3 id="identificazione-di-un-file-o-directory">Identificazione di un file (o directory)</h3>
<pre><code>*  `File`
</code></pre>
<h3 id="accesso-random">Accesso random</h3>
<pre><code>*  `RandomAccessFile`
</code></pre>
<h3 id="lettura-di-file-dati-scrittura-duale">Lettura di file dati (scrittura duale)</h3>
<pre><code>*  `FileInputStream` + `BufferedInputStream` + `DataInputStream`
*  `FileInputStream` + `BufferedInputStream` + `ObjectInputStream`
</code></pre>
<h3 id="lettura-di-file-di-testo-scrittura-duale">Lettura di file di testo (scrittura duale)</h3>
<pre><code>*  `FileReader` + `BufferedReader`
*  `FileInputStream` + `InputStreamReader` + `BufferedReader`
</code></pre>
</section><section>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/reveal-hugo/object-assign.js"></script>

<a href="/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"900","highlight_theme":"default","history":true,"mermaid":[{"startOnLoad":false}],"slide_number":true,"theme":"white","transition":"slide","transition_speed":"fast","width":"1440"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }
  
  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = { 
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>










  <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({"startOnLoad":false});

    let render = (event) => {
      let mermaidElems = event.currentSlide.querySelectorAll('.mermaid');
      if (!mermaidElems.length){
          return
      }
      mermaidElems.forEach(mermaidElem => {
          let processed = mermaidElem.getAttribute('data-processed');
          if (!processed){
              
              mermaid.init(undefined, mermaidElem);
          }
      });
    };
    Reveal.addEventListener('slidechanged', render);
    Reveal.addEventListener('ready', render);
  </script>

    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>

    
  

</body></html>