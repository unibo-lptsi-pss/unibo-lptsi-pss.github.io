<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>Progettazione e Sviluppo del Software</title>
<meta name="description" content="Progettazione e Sviluppo del Software, Tecnologie dei Sistemi Informatici">
<meta name="author" content="Danilo Pianini">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/css/custom-theme.min.b14bd2cb8ebd9f5aadd1914151911df5ab7b2264253b1df19c307933796d5e56.css" id="theme"><link rel="stylesheet" href="/highlight-js/default.min.css">
    
<link rel="stylesheet" href="https://gitcdn.link/repo/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="inputoutput">Input/Output</h1>
<h4 id="progettazione-e-sviluppo-del-software">Progettazione e Sviluppo del Software</h4>
<h4 id="cdl-tecnologie-dei-sistemi-informatici">C.D.L. Tecnologie dei Sistemi Informatici</h4>
<h3 id="roberto-casadei-----robycasadeiuniboitmailtorobycasadeiuniboit"><a href="mailto:roby.casadei@unibo.it">Roberto Casadei — <code>roby.casadei@unibo.it</code></a></h3>
<h3 id="danilo-pianini-----danilopianiniuniboitmailtodanilopianiniuniboit"><a href="mailto:danilo.pianini@unibo.it">Danilo Pianini — <code>danilo.pianini@unibo.it</code></a></h3>
<p><a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> versione stampabile</a></p>
</section><section>
<h2 id="nota">Nota</h2>
<ul>
<li>
<p>Questo materiale è ampiamente basato su quello realizzato dal Prof.
Mirko Viroli, che ringrazio.</p>
</li>
<li>
<p>Ogni errore riscontratovi è esclusiva responsabilità degli autori di questo documento.</p>
</li>
</ul>
</section><section>
<h2 id="outline">Outline</h2>
<h3 id="goal-della-lezione">Goal della lezione</h3>
<ul>
<li>Illustrare le API fornite da Java per l’I/O</li>
<li>Descrivere alcune scelte progettuali e pattern</li>
<li>Mostrare esempi di applicazione</li>
</ul>
<h3 id="argomenti">Argomenti</h3>
<ul>
<li>Classi per gestire file</li>
<li>Classi per gestire Stream (di input/output)</li>
<li>Classi per gestire file di testo</li>
<li>Pattern Decorator</li>
</ul>
</section><section>
<h2 id="il-problema-dellinputoutput">Il problema dell’Input/Output</h2>
<h3 id="uno-dei-problemi-fondamentali-per-un-sistema-operativo">Uno dei problemi fondamentali per un sistema operativo</h3>
<ul>
<li>Gestire le comunicazioni fra CPU e dispositivi affacciati sul BUS</li>
<li>Console, tastiera, mouse, dischi, rete, sensori, schermo</li>
<li>Vi sono varie modalità di interazione possibili
<ul>
<li>sequenziale, random-access, buffered, per carattere/linea/byte/oggetto</li>
</ul>
</li>
<li>I sistemi operativi offrono vari meccanismi
<ul>
<li>file, I/O control interface, socket per il networking, video driver</li>
</ul>
</li>
</ul>
<h3 id="la-libreria-javaio">La libreria <code>java.io.*</code></h3>
<ul>
<li>Fornisce i concetti di File e Stream di dati</li>
<li>Consente una gestione flessibile dei vari aspetti</li>
<li>È estesa con la libreria <code>java.nio</code></li>
<li>È la base di librerie avanzate (networking,..), anche di terze parti (Jackson, Gson, …)</li>
<li>I/O con l’utente in ambiente a finestre è realizzato con le GUI</li>
</ul>
</section><section>
<h1 id="file-e-loro-proprietà">File e loro proprietà</h1>
</section><section>
<h2 id="i-file">I File</h2>
<h3 id="file-system">File system</h3>
<ul>
<li>Il file system è un modulo del S.O. che gestisce la memoria secondaria</li>
<li>Maschera le diversità di dispositivi fisici (HD, CD, DVD, BR, SSD,..)</li>
<li>Maschera le diversità di contenuti informativi (testi, filmati, archivi,..)</li>
<li>Fornisce meccanismi per fornire prestazioni, concorrenza, robustezza</li>
</ul>
<h3 id="file">File</h3>
<ul>
<li>Un file system contiene un insieme di <em><strong>file</strong></em></li>
<li>Un file ha un contenuto informativo che si esprime come sequenza di byte
<ul>
<li>interpretabili in vario modo (testi, programmi, strutture dati)</li>
<li>potrebbe essere un file virtuale, che mappa un dispositivo</li>
<li>un caso particolare è la <strong>directory</strong> (ossia una tabella di ID di file)</li>
<li>può avere specifici diritti di accesso (sola lettura, lettura/scrittura, eseguibilità…)</li>
</ul>
</li>
<li>Le <strong>directory</strong> consentono un’organizzazione gerarchica (ogni file ha un percorso o <em>path</em>)</li>
</ul>
</section><section>
<h2 id="la-classe-javaiofile">La classe <code>java.io.File</code></h2>
<h3 id="usi">Usi</h3>
<ul>
<li>Serve a <em>identificare</em> un preciso file su file systems</li>
<li>Permette di ottenere <em>informazioni</em> varie sul file</li>
<li>Permette di effettuare alcune operazioni sull’intero file
<ul>
<li>cancellazione</li>
<li>spostamento (rinominazione)</li>
</ul>
</li>
<li>Permette di impostare alcune proprietà (se eseguibile, se scrivibile)</li>
<li>Permette di ottenere informazioni generali sul file system</li>
<li>Permette di creare cartelle</li>
<li>$\Rightarrow$ <em>non include operazioni per accedere al suo contenuto</em>, ma vi si potrà agganciare uno <em>stream</em></li>
</ul>
</section><section>
<h2 id="classe-javaiofile-pt1">Classe <code>java.io.File</code>: pt1</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span> <span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">File</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Serializable</span><span style="color:#000">,</span> <span style="color:#000">Comparable</span><span style="color:#000">&lt;</span><span style="color:#000">File</span><span style="color:#000">&gt;</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">pathname</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">parent</span><span style="color:#000">,</span> <span style="color:#000">String</span> <span style="color:#000">child</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">File</span> <span style="color:#000">parent</span><span style="color:#000">,</span> <span style="color:#000">String</span> <span style="color:#000">child</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Path-component accessors -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getName</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getParent</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span> <span style="color:#000">getParentFile</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getPath</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Path operations -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isAbsolute</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getAbsolutePath</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span> <span style="color:#000">getAbsoluteFile</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getCanonicalPath</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">File</span> <span style="color:#000">getCanonicalFile</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Attribute accessors -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">canRead</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">canWrite</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">exists</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isDirectory</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isFile</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isHidden</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">lastModified</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">length</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span></code></pre></div></section><section>
<h2 id="classe-javaiofile-pt2">Classe <code>java.io.File</code>: pt2</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>    <span style="color:#177500">/* -- File operations -- */</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">createNewFile</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">delete</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">deleteOnExit</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">list</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">list</span><span style="color:#000">(</span><span style="color:#000">FilenameFilter</span> <span style="color:#000">filter</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">mkdir</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">renameTo</span><span style="color:#000">(</span><span style="color:#000">File</span> <span style="color:#000">dest</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setLastModified</span><span style="color:#000">(</span><span style="color:#a90d91">long</span> <span style="color:#000">time</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setReadOnly</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setWritable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">writable</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">ownerOnly</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setWritable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">writable</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setReadable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">readable</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">ownerOnly</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setReadable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">readable</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setExecutable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">executable</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">ownerOnly</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">setExecutable</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">executable</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">canExecute</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/* -- Disk usage -- */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">getTotalSpace</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">getFreeSpace</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">getUsableSpace</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="esempio-di-utilizzo-di-file-cercare-file-con-una-certa-enstensione-dentro-una-directory">Esempio di utilizzo di File: cercare file con una certa enstensione dentro una directory</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">it.unibo.io.files</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.File</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.ArrayList</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.List</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">FileUtil</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">USER_HOME</span> <span style="color:#000">=</span> <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">getProperty</span><span style="color:#000">(</span><span style="color:#c41a16">"user.home"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">File</span><span style="color:#000">&gt;</span> <span style="color:#000">findFilesInHomeDirectoryByExtension</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">extension</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#000">var</span> <span style="color:#000">userHome</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">USER_HOME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#000">var</span> <span style="color:#000">allFiles</span> <span style="color:#000">=</span> <span style="color:#000">userHome</span><span style="color:#000">.</span><span style="color:#836c28">listFiles</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">(!</span><span style="color:#000">userHome</span><span style="color:#000">.</span><span style="color:#836c28">isDirectory</span><span style="color:#000">())</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalStateException</span><span style="color:#000">(</span><span style="color:#c41a16">"The user home is not a directory!"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#000">var</span> <span style="color:#000">result</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;</span><span style="color:#000">File</span><span style="color:#000">&gt;();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">var</span> <span style="color:#000">file</span><span style="color:#000">:</span> <span style="color:#000">allFiles</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">.</span><span style="color:#836c28">isFile</span><span style="color:#000">()</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">file</span><span style="color:#000">.</span><span style="color:#836c28">getName</span><span style="color:#000">().</span><span style="color:#836c28">endsWith</span><span style="color:#000">(</span><span style="color:#c41a16">"."</span> <span style="color:#000">+</span> <span style="color:#000">extension</span><span style="color:#000">))</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">result</span><span style="color:#000">.</span><span style="color:#836c28">add</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#000">result</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="accedere-al-contenuto-di-un-file">Accedere al contenuto di un file</h2>
<h3 id="come-fare">Come fare?</h3>
<ul>
<li>Un file ha un contenuto informativo (potenzialmente di grosse dimensioni)</li>
<li>Lo si potrebbe leggere (in vari modi)</li>
<li>Lo si potrebbe scrivere (in vari modi)</li>
<li>Il suo contenuto potrebbe essere interpretabile in vari modi</li>
</ul>
<h3 id="alcuni-di-tali-concetti-sono-condivisi-con-altri-meccanismi">Alcuni di tali concetti sono condivisi con altri meccanismi</h3>
<ul>
<li>Risorse interne al classpath Java</li>
<li>Networking e file di rete</li>
<li>Archivi su database</li>
<li>Depositi di informazione in memoria</li>
</ul>
<h4 id="il-concetto-di-__inputoutput-stream__-è-usato-come-astrazione-unificante">Il concetto di <em><strong>input/output-stream</strong></em> è usato come astrazione unificante</h4>
</section><section>
<h1 id="inputoutputstream">Input/OutputStream</h1>
</section><section>
<h2 id="overview-sugli-inputstream-e-outputstream-in-java">Overview sugli <code>InputStream</code> e <code>OutputStream</code> in Java</h2>
<h3 id="inputstream-e-outputstream"><code>InputStream</code> e <code>OutputStream</code></h3>
<ul>
<li>Stream = flusso (di dati)</li>
<li>Di base, gestiscono flussi binari (di <code>byte</code>) leggibili vs. scrivibili</li>
<li>Sono classi astratte (e non interfacce..)</li>
<li>Possono essere specializzate da “sottoclassi” e “decorazioni”, tra cui
<ul>
<li>Per diverse sorgenti e destinazioni di informazione
<ul>
<li>su file (<code>File</code>(<code>In</code>|<code>Out</code>)<code>putStream</code>)</li>
<li>su memoria (<code>ByteArray</code>(<code>In</code>|<code>Out</code>)<code>putStream</code>)</li>
</ul>
</li>
<li>Per tipo di informazione:
<ul>
<li>valori primitivi (<code>Data</code>(<code>In</code>|<code>Out</code>)<code>putStream</code>)</li>
<li>interi oggetti Java (<code>Object</code>(<code>In</code>|<code>Out</code>)<code>putStream</code>)</li>
<li>archivi compressi (<code>Zip</code>(<code>In</code>|<code>Out</code>)<code>putStream</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="tipicamente-usati-per-alimentare-altre-classi">Tipicamente usati per alimentare altre classi</h3>
<ul>
<li>File di testo (<code>Reader</code>, <code>Writer</code>, e specializzazioni)</li>
<li>Librerie avanzate comunemente usate per l’accesso al file system tipicamente hanno metodi che accettano (<code>In</code>|<code>Out</code>)<code>putStream</code></li>
</ul>
</section><section>
<h2 id="la-classe-javaioinputstream">La classe <code>java.io.InputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">abstract</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">InputStream</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Closeable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// Reads the next byte (0 to 255, -1 is end-of-stream)
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">abstract</span> <span style="color:#a90d91">int</span> <span style="color:#000">read</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">read</span><span style="color:#000">(</span><span style="color:#a90d91">byte</span> <span style="color:#000">b</span><span style="color:#000">[])</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">read</span><span style="color:#000">(</span><span style="color:#a90d91">byte</span> <span style="color:#000">b</span><span style="color:#000">[],</span> <span style="color:#a90d91">int</span> <span style="color:#000">off</span><span style="color:#000">,</span> <span style="color:#a90d91">int</span> <span style="color:#000">len</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">long</span> <span style="color:#000">skip</span><span style="color:#000">(</span><span style="color:#a90d91">long</span> <span style="color:#000">n</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">available</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">close</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">synchronized</span> <span style="color:#a90d91">void</span> <span style="color:#000">mark</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">readlimit</span><span style="color:#000">)</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">synchronized</span> <span style="color:#a90d91">void</span> <span style="color:#000">reset</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">markSupported</span><span style="color:#000">()</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="fileinputstream-e-bytearrayinputstream"><code>FileInputStream</code> e <code>ByteArrayInputStream</code></h2>
<div class="mermaid" data-processed="true" pre-rendered="true"><svg aria-labelledby="chart-title-mermaid-1669200890821 chart-desc-mermaid-1669200890821" role="img" viewBox="0 0 563.5 356" style="max-width: 563.5px;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1669200890821"><title id="chart-title-mermaid-1669200890821"></title><desc id="chart-desc-mermaid-1669200890821"></desc><style>#mermaid-1669200890821 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1669200890821 .error-icon{fill:#552222;}#mermaid-1669200890821 .error-text{fill:#552222;stroke:#552222;}#mermaid-1669200890821 .edge-thickness-normal{stroke-width:2px;}#mermaid-1669200890821 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1669200890821 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1669200890821 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1669200890821 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1669200890821 .marker{fill:#333333;stroke:#333333;}#mermaid-1669200890821 .marker.cross{stroke:#333333;}#mermaid-1669200890821 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1669200890821 g.classGroup text{fill:#9370DB;fill:#131300;stroke:none;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:10px;}#mermaid-1669200890821 g.classGroup text .title{font-weight:bolder;}#mermaid-1669200890821 .nodeLabel,#mermaid-1669200890821 .edgeLabel{color:#131300;}#mermaid-1669200890821 .edgeLabel .label rect{fill:#ECECFF;}#mermaid-1669200890821 .label text{fill:#131300;}#mermaid-1669200890821 .edgeLabel .label span{background:#ECECFF;}#mermaid-1669200890821 .classTitle{font-weight:bolder;}#mermaid-1669200890821 .node rect,#mermaid-1669200890821 .node circle,#mermaid-1669200890821 .node ellipse,#mermaid-1669200890821 .node polygon,#mermaid-1669200890821 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1669200890821 .divider{stroke:#9370DB;stroke:1;}#mermaid-1669200890821 g.clickable{cursor:pointer;}#mermaid-1669200890821 g.classGroup rect{fill:#ECECFF;stroke:#9370DB;}#mermaid-1669200890821 g.classGroup line{stroke:#9370DB;stroke-width:1;}#mermaid-1669200890821 .classLabel .box{stroke:none;stroke-width:0;fill:#ECECFF;opacity:0.5;}#mermaid-1669200890821 .classLabel .label{fill:#9370DB;font-size:10px;}#mermaid-1669200890821 .relation{stroke:#333333;stroke-width:1;fill:none;}#mermaid-1669200890821 .dashed-line{stroke-dasharray:3;}#mermaid-1669200890821 #compositionStart,#mermaid-1669200890821 .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #compositionEnd,#mermaid-1669200890821 .composition{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #dependencyStart,#mermaid-1669200890821 .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #dependencyStart,#mermaid-1669200890821 .dependency{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #extensionStart,#mermaid-1669200890821 .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #extensionEnd,#mermaid-1669200890821 .extension{fill:#333333!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #aggregationStart,#mermaid-1669200890821 .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #aggregationEnd,#mermaid-1669200890821 .aggregation{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #lollipopStart,#mermaid-1669200890821 .lollipop{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 #lollipopEnd,#mermaid-1669200890821 .lollipop{fill:#ECECFF!important;stroke:#333333!important;stroke-width:1;}#mermaid-1669200890821 .edgeTerminals{font-size:11px;}#mermaid-1669200890821 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker aggregation classDiagram" id="classDiagram-aggregationStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker aggregation classDiagram" id="classDiagram-aggregationEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker extension classDiagram" id="classDiagram-extensionStart"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker extension classDiagram" id="classDiagram-extensionEnd"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker composition classDiagram" id="classDiagram-compositionStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker composition classDiagram" id="classDiagram-compositionEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker dependency classDiagram" id="classDiagram-dependencyStart"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="19" class="marker dependency classDiagram" id="classDiagram-dependencyEnd"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="0" class="marker lollipop classDiagram" id="classDiagram-lollipopStart"><circle r="6" cy="7" cx="6" fill="white" stroke="black"></circle></marker></defs><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-start="url(#classDiagram-extensionStart)" style="fill:none" class="edge-pattern-solid relation" id="id1" d="M142.359375,197L137.15104166666666,201.16666666666666C131.94270833333334,205.33333333333334,121.52604166666667,213.66666666666666,116.31770833333333,222C111.109375,230.33333333333334,111.109375,238.66666666666666,111.109375,242.83333333333334L111.109375,247"></path><path marker-start="url(#classDiagram-extensionStart)" style="fill:none" class="edge-pattern-solid relation" id="id2" d="M378.609375,197L383.8177083333333,201.16666666666666C389.0260416666667,205.33333333333334,399.4427083333333,213.66666666666666,404.6510416666667,222C409.859375,230.33333333333334,409.859375,238.66666666666666,409.859375,242.83333333333334L409.859375,247"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(260.484375, 102.5)" id="classid-InputStream-0" class="node default"><rect height="189" width="239.71875" y="-94.5" x="-119.859375" class="outer title-state"></rect><line y2="-64.5" y1="-64.5" x2="119.859375" x1="-119.859375" class="divider"></line><line y2="-48.5" y1="-48.5" x2="119.859375" x1="-119.859375" class="divider"></line><g class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"></span></div></foreignObject><foreignObject transform="translate( -46.671875, -87)" height="18" width="93.34375" class="classTitle"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">InputStream</span></div></foreignObject><foreignObject transform="translate( -112.359375, -41)" height="18" width="72.921875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">read() : int</span></div></foreignObject><foreignObject transform="translate( -112.359375, -19)" height="18" width="125.390625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">read(byte b[]) : int</span></div></foreignObject><foreignObject transform="translate( -112.359375, 3)" height="18" width="224.71875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">read(byte b[], int off, int len) : int</span></div></foreignObject><foreignObject transform="translate( -112.359375, 25)" height="18" width="126.296875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">skip(long n) : long</span></div></foreignObject><foreignObject transform="translate( -112.359375, 47)" height="18" width="104.046875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">available() : int</span></div></foreignObject><foreignObject transform="translate( -112.359375, 69)" height="18" width="90.703125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">close() : void</span></div></foreignObject></g></g><g transform="translate(111.109375, 297.5)" id="classid-FileInputStream-1" class="node default"><rect height="101" width="206.21875" y="-50.5" x="-103.109375" class="outer title-state"></rect><line y2="-20.5" y1="-20.5" x2="103.109375" x1="-103.109375" class="divider"></line><line y2="-4.5" y1="-4.5" x2="103.109375" x1="-103.109375" class="divider"></line><g class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"></span></div></foreignObject><foreignObject transform="translate( -60.453125, -43)" height="18" width="120.90625" class="classTitle"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">FileInputStream</span></div></foreignObject><foreignObject transform="translate( -95.609375, 3)" height="18" width="191.21875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">getChannel() : FileChannel</span></div></foreignObject><foreignObject transform="translate( -95.609375, 25)" height="18" width="166.25"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">getFD() : FileDescriptor</span></div></foreignObject></g></g><g transform="translate(409.859375, 297.5)" id="classid-ByteArrayInputStream-2" class="node default"><rect height="101" width="291.28125" y="-50.5" x="-145.640625" class="outer title-state"></rect><line y2="-20.5" y1="-20.5" x2="145.640625" x1="-145.640625" class="divider"></line><line y2="-4.5" y1="-4.5" x2="145.640625" x1="-145.640625" class="divider"></line><g class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"></span></div></foreignObject><foreignObject transform="translate( -84.9140625, -43)" height="18" width="169.828125" class="classTitle"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">ByteArrayInputStream</span></div></foreignObject><foreignObject transform="translate( -138.140625, 3)" height="18" width="152.953125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">readAllBytes() : byte[]</span></div></foreignObject><foreignObject transform="translate( -138.140625, 25)" height="18" width="276.28125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">readNBytes(byte[] b, int off, int len) : int</span></div></foreignObject></g></g></g></g></g></svg></div>

</section><section>
<h2 id="uso-di-bytearrayinputstream">Uso di <code>ByteArrayInputStream</code></h2>
<h3 id="bytearrayinputstream"><code>ByteArrayInputStream</code></h3>
<ul>
<li>crea un <code>InputStream</code> a partire da un <code>byte[]</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">it.unibo.io.files</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.ByteArrayInputStream</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.IOException</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.InputStream</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseByteArrayStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">,</span> <span style="color:#000">40</span><span style="color:#000">,</span> <span style="color:#000">-</span><span style="color:#000">58</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ByteArrayInputStream</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">int</span> <span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">while</span> <span style="color:#000">(</span><span style="color:#000">c</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">c</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"End of stream"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span> <span style="color:#a90d91">finally</span> <span style="color:#000">{</span> <span style="color:#177500">// assicura la chiusura anche con eccezioni
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">close</span><span style="color:#000">();</span> <span style="color:#177500">// problema: può tirare eccezione!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#177500">// Notare che il main può lanciare IOException, molto scomodo!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="il-costrutto-try-with-resources">Il costrutto <code>try-with-resources</code></h2>
<ul>
<li>vuole la creazione di un <code>java.lang.AutoCloseable</code> come primo argomento</li>
<li>ne assicura la chiusura</li>
<li>si possono opzionalmente aggiungere delle <code>catch</code> di eccezioni</li>
<li>è il modo preferibile di utilizzare risorse in Java!</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">it.unibo.io.files</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.ByteArrayInputStream</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.IOException</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.InputStream</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseTryWithResources</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">30</span><span style="color:#000">,</span> <span style="color:#000">40</span><span style="color:#000">,</span> <span style="color:#000">50</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ByteArrayInputStream</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">))</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">int</span> <span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">while</span> <span style="color:#000">(</span><span style="color:#000">c</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">)</span> <span style="color:#000">{</span> <span style="color:#177500">// C-style
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>                <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">c</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"End of stream"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="esempio-streamdumper">Esempio <code>StreamDumper</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">it.unibo.io.files</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.IOException</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.InputStream</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">StreamDumper</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">// rendo inaccessibile il costruttore
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>    <span style="color:#a90d91">private</span> <span style="color:#000">StreamDumper</span><span style="color:#000">()</span> <span style="color:#000">{}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">dump</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">input</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">value</span> <span style="color:#000">=</span> <span style="color:#000">input</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">();</span> <span style="color:#000">value</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">;</span> <span style="color:#000">value</span> <span style="color:#000">=</span> <span style="color:#000">input</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">())</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">print</span><span style="color:#000">(</span><span style="color:#000">value</span> <span style="color:#000">+</span> <span style="color:#c41a16">"\t"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usestreamdumper----uso-uniforme-di-vari-inputstream"><code>UseStreamDumper</code> – uso uniforme di vari <code>InputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">it.unibo.io.files</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseStreamDumper</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">bytes</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">30</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Cerco un file txt nella home folder dell'utente
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">final</span> <span style="color:#000">var</span> <span style="color:#000">txtFiles</span> <span style="color:#000">=</span> <span style="color:#000">FileUtil</span><span style="color:#000">.</span><span style="color:#836c28">findFilesInHomeDirectoryByExtension</span><span style="color:#000">(</span><span style="color:#c41a16">"txt"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#000">txtFiles</span><span style="color:#000">.</span><span style="color:#836c28">isEmpty</span><span style="color:#000">())</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">throw</span> <span style="color:#a90d91">new</span> <span style="color:#000">IllegalStateException</span><span style="color:#000">(</span><span style="color:#c41a16">"No txt files on the user home directory!"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">final</span> <span style="color:#000">var</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#000">txtFiles</span><span style="color:#000">.</span><span style="color:#836c28">get</span><span style="color:#000">(</span><span style="color:#000">0</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">input</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ByteArrayInputStream</span><span style="color:#000">(</span><span style="color:#000">bytes</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">input2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">txtFiles</span><span style="color:#000">.</span><span style="color:#836c28">get</span><span style="color:#000">(</span><span style="color:#000">0</span><span style="color:#000">).</span><span style="color:#836c28">getAbsolutePath</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"First stream (from memory):"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">StreamDumper</span><span style="color:#000">.</span><span style="color:#836c28">dump</span><span style="color:#000">(</span><span style="color:#000">input</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"\nSecond stream (from file "</span> <span style="color:#000">+</span> <span style="color:#000">file</span><span style="color:#000">.</span><span style="color:#836c28">getPath</span><span style="color:#000">()</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">StreamDumper</span><span style="color:#000">.</span><span style="color:#836c28">dump</span><span style="color:#000">(</span><span style="color:#000">input2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="la-classe-javaiooutputstream">La classe <code>java.io.OutputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">abstract</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">OutputStream</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Closeable</span><span style="color:#000">,</span> <span style="color:#000">Flushable</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#177500">/**
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * ..The byte to be written is the eight
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * low-order bits of the argument &lt;code&gt;b&lt;/code&gt;. The 24
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     * high-order bits of &lt;code&gt;b&lt;/code&gt; are ignored.
</span></span></span><span style="display:flex;"><span><span style="color:#177500">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">abstract</span> <span style="color:#a90d91">void</span> <span style="color:#000">write</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">b</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">write</span><span style="color:#000">(</span><span style="color:#a90d91">byte</span> <span style="color:#000">b</span><span style="color:#000">[])</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">write</span><span style="color:#000">(</span><span style="color:#a90d91">byte</span> <span style="color:#000">b</span><span style="color:#000">[],</span> <span style="color:#a90d91">int</span> <span style="color:#000">off</span><span style="color:#000">,</span> <span style="color:#a90d91">int</span> <span style="color:#000">len</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">flush</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">close</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><h3 id="stream-di-uscita----duale-allinputstream">Stream di uscita – Duale all’<code>InputStream</code></h3>
<ul>
<li>Esistono anche le analoghe specializzazioni <code>ByteArrayOutputStream</code> e <code>FileOutputStream</code></li>
</ul>
</section><section>
<h2 id="useoutputstream"><code>UseOutputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.FileOutputStream</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.IOException</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.OutputStream</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Random</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseOutputStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">output</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// Aggiungo byte random
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#a90d91">final</span> <span style="color:#000">Random</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Random</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">100</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">nextInt</span><span style="color:#000">(</span><span style="color:#000">256</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// Aggiungo un array di byte
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">30</span><span style="color:#000">,</span> <span style="color:#000">40</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">10</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="useoutputstream2----qualche-variante"><code>UseOutputStream2</code> – qualche variante</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Random</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">// Due varianti: uso di java.io.File, e catch con try-with-resources
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseOutputStream2</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">output</span> <span style="color:#000">=</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">File</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// Aggiungo byte random
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#a90d91">final</span> <span style="color:#000">Random</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Random</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">100</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">nextInt</span><span style="color:#000">(</span><span style="color:#000">256</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#177500">// Aggiungo un array di byte
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">{</span> <span style="color:#000">10</span><span style="color:#000">,</span> <span style="color:#000">20</span><span style="color:#000">,</span> <span style="color:#000">30</span><span style="color:#000">,</span> <span style="color:#000">40</span> <span style="color:#000">};</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">10</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span> <span style="color:#a90d91">catch</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">IOException</span> <span style="color:#000">e</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Something went wrong!"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="salvataggio-di-strutture-dati-listbyte">Salvataggio di strutture dati: <code>List&lt;Byte&gt;</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">ListOnFile</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Byte</span><span style="color:#000">&gt;</span> <span style="color:#000">list</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;(</span><span style="color:#000">20</span><span style="color:#000">);</span> <span style="color:#177500">// Creo una lista random
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span><span style="color:#000">[]</span> <span style="color:#000">ar</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">byte</span><span style="color:#000">[</span><span style="color:#000">20</span><span style="color:#000">];</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">new</span> <span style="color:#000">Random</span><span style="color:#000">().</span><span style="color:#836c28">nextBytes</span><span style="color:#000">(</span><span style="color:#000">ar</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span> <span style="color:#000">b</span> <span style="color:#000">:</span> <span style="color:#000">ar</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">list</span><span style="color:#000">.</span><span style="color:#836c28">add</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Prima: "</span> <span style="color:#000">+</span> <span style="color:#000">list</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">byte</span> <span style="color:#000">b</span> <span style="color:#000">:</span> <span style="color:#000">list</span><span style="color:#000">)</span> <span style="color:#000">{</span> <span style="color:#177500">// La riverso su file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">file</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#000">b</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">Byte</span><span style="color:#000">&gt;</span> <span style="color:#000">list2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ArrayList</span><span style="color:#000">&lt;&gt;();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">int</span> <span style="color:#000">c</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">while</span> <span style="color:#000">((</span><span style="color:#000">c</span> <span style="color:#000">=</span> <span style="color:#000">file2</span><span style="color:#000">.</span><span style="color:#836c28">read</span><span style="color:#000">())</span> <span style="color:#000">!=</span> <span style="color:#000">-</span><span style="color:#000">1</span><span style="color:#000">)</span> <span style="color:#000">{</span> <span style="color:#177500">// Ricarico da file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>				<span style="color:#000">list2</span><span style="color:#000">.</span><span style="color:#836c28">add</span><span style="color:#000">((</span><span style="color:#a90d91">byte</span><span style="color:#000">)</span> <span style="color:#000">c</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Dopo: "</span> <span style="color:#000">+</span> <span style="color:#000">list2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="solo-byte">Solo <code>byte</code>?</h2>
<h3 id="problema">Problema…</h3>
<pre><code>*  Poter leggere e scrivere da uno `Stream` anche `int`, `long`, eccetera

%*  Nel caso nuove esigenze simili si debbano creare, non devono esserci interferenze o esplosione di classi
</code></pre>
<h3 id="il-concetto-di-decoratore">Il concetto di decoratore</h3>
<pre><code>*  Si definisce `DataInputStream` che estende `InputStream`{

    *  e similmente `DataOutputStream` che estende `OutputStream`
</code></pre>
<p>}
*  Tale nuova classe comunque fa da wrapper per un <code>InputStream</code>, al quale delega le varie operazioni
*  Un oggetto di tale nuova classe è un decoratore per quello interno.. visto che ne modifica il funzionamento
*  Con questa tecnica è possibile decorare sia un <code>FileInputStream</code> che un <code>ByteArrayInputStream</code> – o altri</p>
</section><section>
<h2 id="decorazione-in-generale">Decorazione, in generale</h2>
<pre><code>![](img/decorator.png)
</code></pre>
</section><section>
<h2 id="decorazione-il-caso-di-datainputstream">Decorazione, il caso di <code>DataInputStream</code></h2>
<pre><code>![](img/dec.png)
</code></pre>
</section><section>
<h2 id="datainputstream"><code>DataInputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">interface</span> <span style="color:#3f6e75">DataInput</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">readFully</span><span style="color:#000">(</span><span style="color:#a90d91">byte</span> <span style="color:#000">b</span><span style="color:#000">[])</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">boolean</span> <span style="color:#000">readBoolean</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">byte</span> <span style="color:#000">readByte</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">int</span> <span style="color:#000">readUnsignedByte</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">short</span> <span style="color:#000">readShort</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">int</span> <span style="color:#000">readUnsignedShort</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">char</span> <span style="color:#000">readChar</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">int</span> <span style="color:#000">readInt</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">long</span> <span style="color:#000">readLong</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">float</span> <span style="color:#000">readFloat</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">double</span> <span style="color:#000">readDouble</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#000">String</span> <span style="color:#000">readUTF</span><span style="color:#000">()</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span> <span style="color:#177500">// non-standard UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>     <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">FilterInputStream</span> <span style="color:#a90d91">extends</span> <span style="color:#000">InputStream</span><span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">DataInputStream</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">extends</span> <span style="color:#000">FilterInputStream</span> <span style="color:#a90d91">implements</span> <span style="color:#000">DataInput</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span><span style="color:#000">InputStream</span> <span style="color:#000">in</span><span style="color:#000">){...}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="dataoutputstream"><code>DataOutputStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">DataOutputStream</span> <span style="color:#a90d91">extends</span> <span style="color:#000">OutputStream</span> <span style="color:#000">...</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">boolean</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeByte</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeShort</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeChar</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeInt</span><span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeLong</span><span style="color:#000">(</span><span style="color:#a90d91">long</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeFloat</span><span style="color:#000">(</span><span style="color:#a90d91">float</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeDouble</span><span style="color:#000">(</span><span style="color:#a90d91">double</span> <span style="color:#000">v</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeBytes</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">s</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeChars</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">s</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>     <span style="color:#a90d91">void</span> <span style="color:#000">writeUTF</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">str</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{..}</span> <span style="color:#177500">// non-standard UTF-8
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">FilterOutputStream</span> <span style="color:#a90d91">extends</span> <span style="color:#000">OutputStream</span> <span style="color:#000">{...}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">DataOutputStream</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">extends</span> <span style="color:#000">FilterOutputStream</span> <span style="color:#a90d91">implements</span> <span style="color:#000">DataOutput</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span><span style="color:#000">OutputStream</span> <span style="color:#000">out</span><span style="color:#000">)</span> <span style="color:#000">{..}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usedatastream"><code>UseDataStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseDataStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataOutputStream</span> <span style="color:#000">dstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">true</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeUTF</span><span style="color:#000">(</span><span style="color:#c41a16">"Ciao"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataInputStream</span> <span style="color:#000">dstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span><span style="color:#000">file2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readBoolean</span><span style="color:#000">());</span> <span style="color:#177500">// Do not change order
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readUTF</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="altra-decorazione-bufferedinputstream-bufferedoutputstream">Altra decorazione: <code>BufferedInputStream</code>, <code>BufferedOutputStream</code></h2>
<h3 id="esigenza">Esigenza</h3>
<pre><code>*  fornire una diversa implementazione interna dello stream
*  non legge un byte alla volta, ma riempie un buffer
*  questo aumenta le performance nell'accesso a file e rete
*  come fornire la funzionalità in modo ortogonale al resto della gestione degli stream?
</code></pre>
<h3 id="bufferedinputstream-bufferedoutputstream"><code>BufferedInputStream</code>, <code>BufferedOutputStream</code></h3>
<pre><code>*  sono ulteriori decoratori, della stessa forma dei precedenti
*  non aggiungono altri metodi
*  per come sono fatti i decoratori, possono essere usati in "cascata" a `DataInputStream` e `DataOutputStream`
</code></pre>
</section><section>
<h2 id="usebuffereddatastream"><code>UseBufferedDataStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseBufferedDataStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream -&gt; bstream -&gt; file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">bstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedOutputStream</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataOutputStream</span> <span style="color:#000">dstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span><span style="color:#000">bstream</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">true</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeUTF</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span> <span style="color:#177500">// Scrive in rappresentazione UTF-16
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream2 -&gt; bstream2 -&gt; file2
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">bstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedInputStream</span><span style="color:#000">(</span><span style="color:#000">file2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataInputStream</span> <span style="color:#000">dstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span><span style="color:#000">bstream2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readBoolean</span><span style="color:#000">());</span> <span style="color:#177500">// Do not change order!!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readUTF</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usebuffereddatastream2----chaining-dei-costruttori"><code>UseBufferedDataStream2</code> – chaining dei costruttori</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.io.*</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseBufferedDataStream2</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream -&gt; bstream -&gt; file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataOutputStream</span> <span style="color:#000">dstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">BufferedOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeBoolean</span><span style="color:#000">(</span><span style="color:#a90d91">true</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">dstream</span><span style="color:#000">.</span><span style="color:#836c28">writeUTF</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span> <span style="color:#177500">// Scrive in rappresentazione UTF-16
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// dstream2 -&gt; bstream2 -&gt; file2
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">DataInputStream</span> <span style="color:#000">dstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">DataInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">BufferedInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">)));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readBoolean</span><span style="color:#000">());</span> <span style="color:#177500">// Do not change order!!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">dstream2</span><span style="color:#000">.</span><span style="color:#836c28">readUTF</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="decorazione-una-visione-complessiva">Decorazione, una visione complessiva</h2>
<pre><code>![](img/dec-all.png)
</code></pre>
</section><section>
<h2 id="altri-decoratori-di-inputstream-e-outputstream">Altri decoratori di <code>InputStream</code> (..e <code>OutputStream</code>)</h2>
<h3 id="sono-molteplici-tutti-usabili-in-combinazione">Sono molteplici, tutti usabili in combinazione</h3>
<pre><code>  *  `CheckedInputStream`: mantiene un "checksum" per verifica integrità
  *  `CipherInputStream`: legge dati poi processati dopo una cifratura
  *  `DeflateInputStream`: legge dati e li comprime in formato "deflate"
  *  `InflaterInputStream`: legge dati e li scompatta dal formato "deflate"
  *  `ProgressMonitorInputStream`: legge dati con possibilità di "unread"
</code></pre>
</section><section>
<h2 id="ancora-sui-decoratori">Ancora sui decoratori</h2>
<h3 id="pro-e-contro">Pro e contro</h3>
<pre><code>*  Sono un mix di polimorfismo e incapsulamento
*  Consentono di comporre funzionalità in modo piuttosto flessibile
*  Danno luogo a più flessibilità rispetto all'ereditarietà
*  Più complicati da usare e comprendere
</code></pre>
<h3 id="con-gli-stream-è-possibile-comporre">Con gli stream, è possibile comporre:</h3>
<pre><code>*  Uno stream di sorgente dati: `FileInputStream`, `ByteArrayInputStream`, ..
*  Uno (o più) stream di gestione interna: `BufferInputStream`, ..
*  Uno stream di presentazione dati: `DataInputStream`, `ObjectInputStream`, ..
</code></pre>
</section><section>
<p>\section[De/serializzazione]{De/Serializzazione di oggetti}</p>
<h2 id="file-ed-encoding">File ed encoding</h2>
<h3 id="il-contenuto-dei-file">Il contenuto dei file</h3>
<pre><code>  Supponiamo utilizziate un `DataOutputStream` per scrivere in sequenza i numeri da 0 a 20 (escluso)


        *  Che cosa avete realmente scritto?
        *  avete scritto i byte da zero a 19
        *  In esadecimale, `0x000102030405060708090A0B0C0D0E0F10111213`
        *  **Non** avete scritto il testo `012345678910111213141516171819`






    *  I file sono sequenze di byte
    *  Per fare input/output occorre stabilire:


      *  Una conversione dalla struttura dati che stiamo manipolando a sequenza di byte (encoding)
      *  Una conversione da sequenza di byte a struttura dati (decoding)


    *  I `Data-Stream` offrono encoding e decoding per tipi primitivi
    *  Come trattare strutture dati più articolate?
</code></pre>
</section><section>
<h2 id="serializzazione-di-oggetti">Serializzazione di oggetti</h2>
<h3 id="motivazioni">Motivazioni</h3>
<pre><code>*  Rendere gli oggetti persistenti, e trasferibili a istanze di JVM diverse
*  Esempio: memorizzarli su file, su array di byte, trasferirli via rete
*  Java Serialization{

    *  serializza con relativa semplicità strutture di oggetti anche complicate
    *  a volte è fondamentale apportarvi correzioni ad-hoc
</code></pre>
<p>}</p>
<h3 id="ingredienti-serialization">Ingredienti Serialization</h3>
<pre><code>    *  Interfaccia "tag" `java.io.Serializable`
    *  Classi `ObjectInputStream` e `ObjectOutputStream`
    *  Keyword `transient` per campi che non devono essere serializzati
    *  Metodi `readObject` e `writeObject` (e altri) per modificare la serializzazione di default per un oggetto, o per motivi di sicurezza
    *  Meccanismo `UID` per gestire versioni diverse delle classi
</code></pre>
</section><section>
<h2 id="diagramma-uml-con-objectinputstream">Diagramma UML con <code>ObjectInputStream</code></h2>
<pre><code>![](img/object.png)
</code></pre>
</section><section>
<h2 id="classe-person-e-linterfaccia-tag-serializable">Classe <code>Person</code> e l’interfaccia “tag” <code>Serializable</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Persona</span> <span style="color:#a90d91">implements</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">567742502623265945L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">Persona</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">,</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">,</span> 
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">=</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">=</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">+</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">?</span> <span style="color:#c41a16">"spos"</span> <span style="color:#000">:</span> <span style="color:#c41a16">"non-spos"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div><h3 id="serializable----implementata-già-da-molte-classi-non-object"><code>Serializable</code> – implementata già da molte classi, non <code>Object</code></h3>
<pre><code>*  da implementare per avere oggetti "automaticamente" serializzabili
*  ciò non comporta alcun contratto da ottemperare
</code></pre>
</section><section>
<h2 id="classe-useobjectstream">Classe <code>UseObjectStream</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseObjectStream</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// ostream -&gt; bstream -&gt; file
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">file</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">OutputStream</span> <span style="color:#000">bstream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedOutputStream</span><span style="color:#000">(</span><span style="color:#000">file</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">ostream</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectOutputStream</span><span style="color:#000">(</span><span style="color:#000">bstream</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">10000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeDouble</span><span style="color:#000">(</span><span style="color:#000">5</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">util</span><span style="color:#000">.</span><span style="color:#836c28">Date</span><span style="color:#000">());</span> <span style="color:#177500">// Classe serializ.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#000">ostream</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">Persona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">,</span> <span style="color:#000">1960</span><span style="color:#000">,</span> <span style="color:#a90d91">false</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// ostream2 -&gt; bstream2 -&gt; file2
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">file2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">bstream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedInputStream</span><span style="color:#000">(</span><span style="color:#000">file2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">ostream2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectInputStream</span><span style="color:#000">(</span><span style="color:#000">bstream2</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readDouble</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">());</span> <span style="color:#177500">// carica il Date
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>            <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">ostream2</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">());</span> <span style="color:#177500">// carica la Persona
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="classe-useobjectstream-note">Classe <code>UseObjectStream</code>: note</h2>
<h3 id="note">Note</h3>
<pre><code>*  la `writeObject()`/`readObject()` fallisce se l'oggetto non è serializzabile{

  *  se la classe dell'oggetto non implementa `Serializable`
  *  la la classe dell'oggetto ha un campo che sia un oggetto non serializzabile
</code></pre>
<p>}
*  la <code>readObject()</code> fallisce se la classe dell’oggetto non è disponibile
*  la <code>readObject()</code> fallisce se la classe dell’oggetto è una versione diversa</p>
</section><section>
<h2 id="come-funzionano-writeobjectreadobject">Come funzionano <code>writeObject()</code>/<code>readObject()</code></h2>
<h3 id="objectoutputstreamwriteobject"><code>ObjectOutputStream.writeObject()</code></h3>
<pre><code>*  Lancia una eccezione se l'oggetto non è serializzabile
*  Scrive sullo stream i campi dell'oggetto uno a uno &lt;br&gt; (di tipi primitivi o serializzabili a loro volta)
*  Si evitano i campi con modificatore `transient`
*  In questo processo, si evita di scrivere due volte uno stesso oggetto
</code></pre>
<h3 id="objectinputstreamreadobject"><code>ObjectInputStream.readObject()</code></h3>
<pre><code>*  Lancia una eccezione se non trova la classe o non è *__compatibile__*
*  Chiama il costruttore senza argomenti della prima sopra-classe non serializzabile, e da lì in giù non chiama altri costruttori
*  Ripristina il valore dei campi leggendoli dallo stream
*  Lascia inalterati i campi `transient`
</code></pre>
</section><section>
<h2 id="il-problema-delle-versioni-di-una-classe-serialversionuid">Il problema delle versioni di una classe: <code>serialVersionUID</code></h2>
<h3 id="problema-1">Problema</h3>
<pre><code>*  Si serializza un oggetto, la classe viene modificata e ricompilata, e quindi si ritira su l'oggetto..  i dati sarebbero facilmente "corrupted"
</code></pre>
<h3 id="soluzione-ogni-classe-che-implementa-serializable">Soluzione: ogni classe che implementa <code>Serializable</code>…</h3>
<pre><code>*  .. deve fornire una costante "`long serialVersionUID`" che contiene un numero univoco per quella versione della classe
*  Se non corrisponde a quello dell'oggetto caricato si ha eccezione
</code></pre>
<h3 id="fatti">Fatti</h3>
<pre><code>*  Se mancante Eclipse segnala warning. Può generarne uno a richiesta.
*  Se mancante la JVM ne calcola uno suo ma è sconsigliato.
*  Molti lasciano il campo al valore $1$, non preoccupandosene.
</code></pre>
</section><section>
<h2 id="i-campi-transient">I campi <code>transient</code></h2>
<h3 id="i-campi-transient-non-vengono-serializzati-in-quali-casi-servono">I campi <code>transient</code> non vengono serializzati. In quali casi servono?</h3>
<pre><code>*  Campi aggiunti per motivi di performance (p.e., caching di un calcolo), e che quindi possono essere ricostruiti a partire dagli altri campi
*  Campi che contengono info specifiche sul run corrente della JVM (p.e., logs), e che quindi non avrebbero più senso quando l'oggetto viene recuperato dallo stream
*  Campi che contengono oggetti comunque non serializzabili (p.e., `Object`), e che quindi porterebbero ad una eccezione
*  Campi per i quali si vuole prevedere un meccanismo di serializzazione diverso
</code></pre>
</section><section>
<h2 id="cpersona-con-caching-tostring-pt1"><code>CPersona</code> con caching <code>toString</code>, pt1</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">CPersona</span> <span style="color:#a90d91">implements</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// Generated by Eclipse
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">8985026380526620812L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">transient</span> <span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">CPersona</span><span style="color:#000">(</span><span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">,</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">,</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">=</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">=</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getNome</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">getAnnoNascita</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">isSposato</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="cpersona-con-caching-tostring-pt2"><code>CPersona</code> con caching <code>toString</code>, pt2</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">setAnnoNascita</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">annoNascita</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">=</span> <span style="color:#000">annoNascita</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">setSposato</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#a90d91">boolean</span> <span style="color:#000">sposato</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">=</span> <span style="color:#000">sposato</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#000">String</span> <span style="color:#000">computeToString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">annoNascita</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">+</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">sposato</span> <span style="color:#000">?</span> <span style="color:#c41a16">"spos"</span> <span style="color:#000">:</span> <span style="color:#c41a16">"non-spos"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">err</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Log: The cache is empty..."</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span> <span style="color:#000">=</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">computeToString</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">cachedToString</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="usetransient"><code>UseTransient</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseTransient</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">out</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">CPersona</span> <span style="color:#000">p</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">CPersona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">,</span> <span style="color:#000">1960</span><span style="color:#000">,</span> <span style="color:#a90d91">false</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Prima stampa "</span> <span style="color:#000">+</span> <span style="color:#000">p</span><span style="color:#000">);</span> <span style="color:#177500">// cache vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Seconda stampa "</span> <span style="color:#000">+</span> <span style="color:#000">p</span><span style="color:#000">);</span> <span style="color:#177500">// cache non vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">out</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">CPersona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">,</span> <span style="color:#000">1960</span><span style="color:#000">,</span> <span style="color:#a90d91">false</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Ri-carico l'oggetto... "</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">CPersona</span> <span style="color:#000">q</span> <span style="color:#000">=</span> <span style="color:#000">(</span><span style="color:#000">CPersona</span><span style="color:#000">)</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">();</span> <span style="color:#177500">//attenzione al cast!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Prima stampa "</span> <span style="color:#000">+</span> <span style="color:#000">q</span><span style="color:#000">);</span> <span style="color:#177500">// cache vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Seconda stampa "</span> <span style="color:#000">+</span> <span style="color:#000">q</span><span style="color:#000">);</span> <span style="color:#177500">// cache non vuota
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="progettazione-di-una-serializzazione-ad-hoc">Progettazione di una serializzazione ad-hoc</h2>
<h3 id="serializzazione-ad-hoc">Serializzazione ad-hoc</h3>
<pre><code>*  Il modello transient/non-transient a volte non è sufficiente
*  A volte serve serializzare in modo diverso certi campi
*  È possibile definire per la classe serializzabile i metodi "`void readObject(ObjectInputStream in)`" e "`void writeObject(ObjectOutputStream out)`"
*  Se definiti, `ObjectInputStream` e `ObjectOutputStream` chiamano quelli
</code></pre>
<h3 id="dettagli">Dettagli</h3>
<pre><code>*  Tali metodi possono cominciare con la chiamata a `defaultReadObject()`/`defaultWriteObject()`, per leggere i campi non-statici e non-transienti
*  Si può quindi proseguire scrivendo/leggendo negli stream in input quello che si vuole
</code></pre>
</section><section>
<h2 id="apersona-serializzazione-ad-hoc-per-una-data"><code>APersona</code>: serializzazione ad-hoc per una data</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">APersona</span> <span style="color:#a90d91">implements</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">-</span><span style="color:#000">8985026380526620812L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">transient</span> <span style="color:#000">Date</span> <span style="color:#000">lastUse</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Date</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">APersona</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">nome</span><span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">=</span> <span style="color:#000">nome</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">used</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Date</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span><span style="color:#000">()</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">nome</span> <span style="color:#000">+</span> <span style="color:#c41a16">":"</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">+</span> <span style="color:#000">(</span><span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span> <span style="color:#000">==</span> <span style="color:#a90d91">null</span> <span style="color:#000">?</span> <span style="color:#c41a16">"null"</span> <span style="color:#000">:</span> <span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span><span style="color:#000">.</span><span style="color:#836c28">getTime</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">writeObject</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">out</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">out</span><span style="color:#000">.</span><span style="color:#836c28">defaultWriteObject</span><span style="color:#000">();</span> <span style="color:#177500">// accetto il comportamento di default
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">err</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"writing"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// una sorta di costruttore..
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">readObject</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">in</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span><span style="color:#000">,</span> <span style="color:#000">ClassNotFoundException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">defaultReadObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">err</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"reading"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span><span style="color:#000">.</span><span style="color:#836c28">lastUse</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Date</span><span style="color:#000">();</span> <span style="color:#177500">// in lettura, ripristino la data corrente
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>	<span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="useadhocserialization"><code>UseAdHocSerialization</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">it.unibo.io.files.UseFile</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseAdHocSerialization</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectOutputStream</span> <span style="color:#000">out</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectOutputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">APersona</span> <span style="color:#000">p</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">APersona</span><span style="color:#000">(</span><span style="color:#c41a16">"Rossi"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">p</span><span style="color:#000">.</span><span style="color:#836c28">used</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">p</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">out</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#000">p</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Ri-carico l'oggetto... "</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">ObjectInputStream</span> <span style="color:#000">in</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">ObjectInputStream</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">APersona</span> <span style="color:#000">q</span> <span style="color:#000">=</span> <span style="color:#000">(</span><span style="color:#000">APersona</span><span style="color:#000">)</span> <span style="color:#000">in</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">q</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="serializzazione-ad-hoc-per-javautilarraylist-pt1">Serializzazione ad-hoc per <code>java.util.ArrayList</code>, pt1</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">package</span> <span style="color:#000">java.util</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">ArrayList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span> <span style="color:#a90d91">extends</span> <span style="color:#000">AbstractList</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">implements</span> <span style="color:#000">List</span><span style="color:#000">&lt;</span><span style="color:#000">E</span><span style="color:#000">&gt;,</span> <span style="color:#000">RandomAccess</span><span style="color:#000">,</span> <span style="color:#000">Cloneable</span><span style="color:#000">,</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">Serializable</span>
</span></span><span style="display:flex;"><span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">long</span> <span style="color:#000">serialVersionUID</span> <span style="color:#000">=</span> <span style="color:#000">8683452581122892189L</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">transient</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">elementData</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">int</span> <span style="color:#000">size</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">writeObject</span><span style="color:#000">(</span><span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">ObjectOutputStream</span> <span style="color:#000">s</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throws</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">IOException</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Write out element count, and any hidden stuff
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">defaultWriteObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Write out array length
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">elementData</span><span style="color:#000">.</span><span style="color:#836c28">length</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Write out all elements in the proper order.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">&lt;</span><span style="color:#000">size</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">writeObject</span><span style="color:#000">(</span><span style="color:#000">elementData</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="serializzazione-ad-hoc-per-javautilarraylist-pt2">Serializzazione ad-hoc per <code>java.util.ArrayList</code>, pt2</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">void</span> <span style="color:#000">readObject</span><span style="color:#000">(</span><span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">ObjectInputStream</span> <span style="color:#000">s</span><span style="color:#000">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">throws</span> <span style="color:#000">java</span><span style="color:#000">.</span><span style="color:#836c28">io</span><span style="color:#000">.</span><span style="color:#836c28">IOException</span><span style="color:#000">,</span> <span style="color:#000">ClassNotFoundException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Read in size, and any hidden stuff
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">defaultReadObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Read in array length and allocate array
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">int</span> <span style="color:#000">arrayLength</span> <span style="color:#000">=</span> <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">elementData</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span><span style="color:#000">[</span><span style="color:#000">arrayLength</span><span style="color:#000">];</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#177500">// Read in all elements in the proper order.
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>        <span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span><span style="color:#000">=</span><span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">&lt;</span><span style="color:#000">size</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">a</span><span style="color:#000">[</span><span style="color:#000">i</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">s</span><span style="color:#000">.</span><span style="color:#836c28">readObject</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span><span style="display:flex;"><span> 
</span></span></code></pre></div></section><section>
<h2 id="note-sulla-serializzazione-java">Note sulla serializzazione Java</h2>
<h3 id="raramente-utilizzata-in-applicazioni-vere">Raramente utilizzata in applicazioni “vere”</h3>
<pre><code>    Applicazioni vere tendono a non utilizzare `Object`(`In`/`Out`)`putStream`:


        *  Nessuna standardizzazione
        *  Poco efficiente in termini di spazio
        *  Dispendiosa in termini di performance
        *  Scarsa portabilità (solo da/a software Java)
        *  `readObject` / `writeObject` in qualche modo violano il linguaggio
</code></pre>
<h3 id="importanza-di-serializable">Importanza di <code>Serializable</code></h3>
<pre><code>    Approcci diversi alla serializzazione spesso:


        *  Serializzano oggetti `Serializable` con campi `Serializable` e non `transient` (deve valere ricorsivamente)
        *  Prevedono sistemi custom per la serializzazione di oggetti diversi
        *  Non fanno uso di `readObject` / `writeObject`
</code></pre>
</section><section>
<h1 id="randomaccessfile">`RandomAccessFile</h1>
</section><section>
<p>`</p>
<h2 id="classe-randomaccessfile">Classe <code>RandomAccessFile</code></h2>
<h3 id="motivazioni-1">Motivazioni</h3>
<pre><code>*  Alcuni file sono di grosse dimensioni, e non vengo letti/scritti per intero come nei casi visti finora
*  Bensì si modifica qualche elemento "a metà", o se ne aggiungono in fondo, o si legge un elemento in una data posizione
</code></pre>
<h3 id="classe-randomaccessfile-1">Classe <code>RandomAccessFile</code></h3>
<pre><code>*  Non è usata tramite `InputStream` o `OutputStream`
*  Fornisce i metodi di `DataInput` e `DataOutput`
*  Fornisce metodi aggiuntivi:{

    *  `getFilePointer`: torna la posizione corrente nel file
    *  `seek`: imposta la nuova posizione nel file
    *  `length`: torna la lunghezza del file
    *  `setLength`: imposta la lunghezza del file
</code></pre>
<p>}</p>
</section><section>
<h2 id="classe-randomaccessfile-2">Classe <code>RandomAccessFile</code></h2>
<pre><code>![](img/random.png)
</code></pre>
</section><section>
<h2 id="userandomaccessfile"><code>UseRandomAccessFile</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseRandomAccessFile</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">IOException</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">RandomAccessFile</span> <span style="color:#000">raf</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">RandomAccessFile</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">UseFile</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">,</span> <span style="color:#c41a16">"rw"</span><span style="color:#000">))</span> <span style="color:#000">{</span> <span style="color:#177500">// read-write
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> <span style="color:#000">(</span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">0</span><span style="color:#000">;</span> <span style="color:#000">i</span> <span style="color:#000">&lt;</span> <span style="color:#000">100000</span><span style="color:#000">;</span> <span style="color:#000">i</span><span style="color:#000">++)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"writing: "</span> <span style="color:#000">+</span> <span style="color:#000">i</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">writeInt</span><span style="color:#000">(</span><span style="color:#000">i</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">seek</span><span style="color:#000">(</span><span style="color:#000">23000</span> <span style="color:#000">*</span> <span style="color:#000">4</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"reading in position 23000*4: "</span> <span style="color:#000">+</span> <span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">setLength</span><span style="color:#000">(</span><span style="color:#000">800000</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"extending the size"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">seek</span><span style="color:#000">(</span><span style="color:#000">123000</span> <span style="color:#000">*</span> <span style="color:#000">4</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"reading in position 123000*4: "</span> <span style="color:#000">+</span> <span style="color:#000">raf</span><span style="color:#000">.</span><span style="color:#836c28">readInt</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h1 id="file-di-testo">File di testo</h1>
</section><section>
<h2 id="limitazione-degli-stream-binari-visti-finora">Limitazione degli stream binari visti finora</h2>
<p>Finora abbiamo visto stream binari, ed in particolare di oggetti Java</p>
<pre><code>*  Non esiste uno standard documentato


  *  Gli standard descrivono in modo inequivoco un protocollo (in questo caso di de/serializzazione)
  *  Difficile scrivere librerie per leggere e scrivere in quel formato
  *  Bassa **standardizzazione**


*  Non comprensibili da applicazioni non-Java


  *  Oggetti serializzati non apribili da applicazioni in Javascript, Python, eccetera
  *  Non adatti e.g., per applicazioni web
  *  Bassa **portabilità**


*  Non comprensibili se aperti in formato testuale


  *  Non modificabili da umani
  *  Non adatti e.g., per file di configurazione
  *  Bassa **leggibilità** e quindi **intelligibilità**
</code></pre>
</section><section>
<h2 id="limitazione-degli-stream-binari-visti">Limitazione degli stream binari visti</h2>
<h3 id="standardizzazione-e-portabilità">Standardizzazione e portabilità</h3>
<pre><code>  *  Non direttamente ascrivibili al formato binario
  *  (che comunque non aiuta...)
  *  Esistono standard portabili binari, come ProtocolBuffers
</code></pre>
<h3 id="leggibilità-e-intelligibilità">Leggibilità e intelligibilità</h3>
<pre><code>  *  Problema comune a tutti i meccanismi finora visti
  *  Esistono standard per scrivere oggetti in formato testuale
  *  Problema da risolvere in due fasi:


    *  Conversione da oggetto a stringa di testo e viceversa
    *  Conversione da stringa di testo a file e viceversa
</code></pre>
</section><section>
<h2 id="conversione-da-oggetto-a-stringa-di-testo-e-viceversa">Conversione da oggetto a stringa di testo e viceversa</h2>
<pre><code>*  Banale nel caso in cui l'oggetto sia una stringa
*  Molto più complicato per strutture dati arbitrarie
*  Passo necessario verso l'interoperabilità fra linguaggi
</code></pre>
<h3 id="alcuni-formati-standard-per-la-conversione-di-oggetti-in-testo">(Alcuni) Formati standard per la conversione di oggetti in testo</h3>
<pre><code>  *  JavaScript Object Notation -- JSON (RFC 7159)


    *  Nato in seno a JavaScript (che non c'entra nulla con Java)
    *  Molto usato nel web


  *  Tom's Obvious, Minimal Language -- TOML


    *  Particolarmente indicato per file di configurazione


  *  YAML Ain't Markup Language -- YAML


    *  Superset di JSON dalla versione 1.2
    *  Supporto per funzioni avanzate (e.g. anchoring)
    *  Molto usato per file di configurazione complessi
</code></pre>
</section><section>
<h2 id="conversione-stringa-a-file-di-testo">Conversione stringa a file di testo</h2>
<p>Problema risolto con tabelle di conversione (text encoding)</p>
<p>Nota: importante anche per la rappr. <strong>in memoria</strong> dei caratteri</p>
<h3 id="text-encoding">Text Encoding</h3>
<pre><code>    *  ASCII (RFC 20)


      *  l'encoding che usa il linguaggio C per i `char`
      *  1 byte per carattere (massimo 256 caratteri)


    *  UTF-8 (RFC 3629)


      *  Standard di fatto sul web, encoding di default in Linux
      *  encoding da usare per i sorgenti di codice
      *  da 1 a 4 byte per carattere
      *  Codifica 1.112.064 simboli


    *  UTF-16 (RFC 2781)


      *  Encoding in memoria delle `String` in Java
      *  2 o 4 byte per carattere
      *  Codifica 1.112.064 simboli


    *  ISO Latin (ISO/IEC 8859-1:1998)


      *  Encoding di default del testo in Windows
</code></pre>
</section><section>
<h2 id="file-di-testo-1">File di testo</h2>
<h3 id="file-binari-vs-file-di-testo">File binari vs file di testo</h3>
<pre><code>*  Gli stream binari sono quelli visti, sono costituiti da sequenze di byte e il modo col quale si ottengono da questi altri tipi primitivi è standard
*  Gli "stream di testo" hanno problematiche diverse:{

    *  sono sequenze di caratteri
    *  la codifica (UTF-8, UTF-16, ASCII) potrebbe variare
    *  la codifica potrebbe dettare anche i codici speciali di "a capo" etc.
</code></pre>
<p>}
*  Questa gestione richiede classi specifiche</p>
<h3 id="reader-e-writer"><code>Reader</code> (e <code>Writer)</code></h3>
<pre><code>*  `Reader`: la radice, con metodi per leggere caratteri, e linee di testo
*  `StringReader`: decoratore per prelevare da `String`
*  `BufferedReader`: decoratore per ottimizzare gli accessi
*  `InputStreamReader`: decoratore che incapsula un `InputStream`
*  `FileReader`: sua estensione per leggere da file via `FileInputStream`
</code></pre>
</section><section>
<h2 id="uml-classi-relative-ai-reader-writer-analoghi">UML classi relative ai reader (writer analoghi)</h2>
<pre><code>![](img/text.png)
</code></pre>
</section><section>
<h2 id="esempio-usereaderswriters">Esempio: <code>UseReadersWriters</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseReadersWriters</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">FILE_NAME</span> <span style="color:#000">=</span> <span style="color:#c41a16">"/home/mirko/aula/oop/15/a.txt"</span><span style="color:#000">;</span> <span style="color:#177500">// TODO: fix path
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">BufferedWriter</span> <span style="color:#000">w</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedWriter</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">FileWriter</span><span style="color:#000">(</span><span style="color:#000">FILE_NAME</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"di file"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">FileReader</span><span style="color:#000">(</span><span style="color:#000">FILE_NAME</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span> <span style="color:#177500">// null, indica la fine del file!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span> <span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">FileReader</span><span style="color:#000">(</span><span style="color:#000">FILE_NAME</span><span style="color:#000">))</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">)</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#000">String</span> <span style="color:#000">line</span> <span style="color:#000">=</span> <span style="color:#a90d91">null</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#a90d91">while</span><span style="color:#000">(</span> <span style="color:#000">(</span><span style="color:#000">line</span> <span style="color:#000">=</span> <span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">())</span> <span style="color:#000">!=</span> <span style="color:#a90d91">null</span><span style="color:#000">){</span>
</span></span><span style="display:flex;"><span>		        <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">line</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		    <span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="esempio-usestreamreaderswriters">Esempio: <code>UseStreamReadersWriters</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#177500">// Soluzione con specifica della codifica dei caratteri
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UseStreamReadersWriters</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">BufferedWriter</span> <span style="color:#000">w</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedWriter</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">OutputStreamWriter</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileOutputStream</span><span style="color:#000">(</span><span style="color:#000">UseReadersWriters</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">),</span><span style="color:#c41a16">"UTF-16"</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"Prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">write</span><span style="color:#000">(</span><span style="color:#c41a16">"di file"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">w</span><span style="color:#000">.</span><span style="color:#836c28">newLine</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">try</span><span style="color:#000">(</span><span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">r</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">InputStreamReader</span><span style="color:#000">(</span>
</span></span><span style="display:flex;"><span>					<span style="color:#a90d91">new</span> <span style="color:#000">FileInputStream</span><span style="color:#000">(</span><span style="color:#000">UseReadersWriters</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">),</span><span style="color:#c41a16">"UTF-16"</span><span style="color:#000">))){</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span>
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">r</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span> <span style="color:#177500">// null
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">}</span>	
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="il-caso-di-systemin-e-systemout">Il caso di: <code>System.in</code> e <code>System.out</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">SystemInOut</span> <span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span><span style="color:#000">(</span><span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span><span style="color:#000">)</span> <span style="color:#a90d91">throws</span> <span style="color:#000">Exception</span><span style="color:#000">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">InputStream</span> <span style="color:#000">is</span> <span style="color:#000">=</span> <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">in</span><span style="color:#000">;</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">BufferedReader</span> <span style="color:#000">br</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">BufferedReader</span><span style="color:#000">(</span><span style="color:#a90d91">new</span> <span style="color:#000">InputStreamReader</span><span style="color:#000">(</span><span style="color:#000">is</span><span style="color:#000">));</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#000">br</span><span style="color:#000">.</span><span style="color:#836c28">readLine</span><span style="color:#000">());</span> <span style="color:#177500">// può lanciare una IOException
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">PrintStream</span> <span style="color:#000">ps</span> <span style="color:#000">=</span> <span style="color:#000">System</span><span style="color:#000">.</span><span style="color:#836c28">out</span><span style="color:#000">;</span> 
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// una sotto-classe di OutputStream, che incapsula un Writer
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">ps</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"Un comando noto"</span><span style="color:#000">);</span> <span style="color:#177500">// non lancia eccezioni!
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#000">ps</span><span style="color:#000">.</span><span style="color:#836c28">format</span><span style="color:#000">(</span><span style="color:#c41a16">"Altro comando noto.. %d %f %s\n"</span><span style="color:#000">,</span> <span style="color:#000">10</span><span style="color:#000">,</span><span style="color:#000">20</span><span style="color:#000">.</span><span style="color:#836c28">2</span><span style="color:#000">,</span><span style="color:#c41a16">"prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// scrittura di file con PrintStream
</span></span></span><span style="display:flex;"><span><span style="color:#177500"></span>		<span style="color:#a90d91">final</span> <span style="color:#000">PrintStream</span> <span style="color:#000">ps2</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">PrintStream</span><span style="color:#000">(</span><span style="color:#000">UseReadersWriters</span><span style="color:#000">.</span><span style="color:#836c28">FILE_NAME</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">(</span><span style="color:#c41a16">"prova"</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">print</span><span style="color:#000">(</span><span style="color:#000">10</span><span style="color:#000">);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">println</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">ps2</span><span style="color:#000">.</span><span style="color:#836c28">close</span><span style="color:#000">();</span>
</span></span><span style="display:flex;"><span>	<span style="color:#000">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">}</span>
</span></span></code></pre></div></section><section>
<h2 id="riassunto-classi">Riassunto classi</h2>
<h3 id="identificazione-di-un-file-o-directory">Identificazione di un file (o directory)</h3>
<pre><code>*  `File`
</code></pre>
<h3 id="accesso-random">Accesso random</h3>
<pre><code>*  `RandomAccessFile`
</code></pre>
<h3 id="lettura-di-file-dati-scrittura-duale">Lettura di file dati (scrittura duale)</h3>
<pre><code>*  `FileInputStream` + `BufferedInputStream` + `DataInputStream`
*  `FileInputStream` + `BufferedInputStream` + `ObjectInputStream`
</code></pre>
<h3 id="lettura-di-file-di-testo-scrittura-duale">Lettura di file di testo (scrittura duale)</h3>
<pre><code>*  `FileReader` + `BufferedReader`
*  `FileInputStream` + `InputStreamReader` + `BufferedReader`
</code></pre>
</section><section>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/reveal-hugo/object-assign.js"></script>

<a href="/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"900","highlight_theme":"default","history":true,"mermaid":[{"startOnLoad":false}],"slide_number":true,"theme":"white","transition":"slide","transition_speed":"fast","width":"1440"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }
  
  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = { 
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>










  <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({"startOnLoad":false});

    let render = (event) => {
      let mermaidElems = event.currentSlide.querySelectorAll('.mermaid');
      if (!mermaidElems.length){
          return
      }
      mermaidElems.forEach(mermaidElem => {
          let processed = mermaidElem.getAttribute('data-processed');
          if (!processed){
              
              mermaid.init(undefined, mermaidElem);
          }
      });
    };
    Reveal.addEventListener('slidechanged', render);
    Reveal.addEventListener('ready', render);
  </script>

    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>

    
  

</body></html>