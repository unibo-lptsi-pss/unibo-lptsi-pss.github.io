<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>Progettazione e Sviluppo del Software</title>
<meta name="description" content="Progettazione e Sviluppo del Software, Tecnologie dei Sistemi Informatici">
<meta name="author" content="Danilo Pianini">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/css/custom-theme.min.c5d5307c22aeba26e5f63813bdbc90c5483e809383467a8e6f523d7f756010c5.css" id="theme"><link rel="stylesheet" href="/highlight-js/default.min.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="polimorfismo-e-tipi-a-runtime">Polimorfismo e tipi a runtime</h1>
<h4 id="progettazione-e-sviluppo-del-software">Progettazione e Sviluppo del Software</h4>
<h4 id="cdl-tecnologie-dei-sistemi-informatici">C.D.L. Tecnologie dei Sistemi Informatici</h4>
<h3 id="danilo-pianini"><a href="mailto:danilo.pianini@unibo.it">Danilo Pianini — <code>danilo.pianini@unibo.it</code></a></h3>
<h3 id="gianluca-aguzzi"><a href="mailto:gianluca.aguzzi@unibo.it">Gianluca Aguzzi — <code>gianluca.aguzzi@unibo.it</code></a></h3>
<h3 id="angelo-filaseta"><a href="mailto:angelo.filaseta@unibo.it">Angelo Filaseta — <code>angelo.filaseta@unibo.it</code></a></h3>
<p>Compiled on: 2025-11-13
 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> versione stampabile</a></p>
<p><a href=".."><i class="fa fa-undo" aria-hidden="true"></i> back</a></p>
</section><section>
<h2 id="outline">Outline</h2>
<h3 id="goal-della-lezione">Goal della lezione</h3>
<ul>
<li>Illustrare la connessione fra polimorfismo inclusivo e ereditarietà</li>
<li>Mostrare le interconnessioni con interfacce e classi astratte</li>
<li>Mostrare le varie ripercussioni nel linguaggio</li>
</ul>
<h3 id="argomenti">Argomenti</h3>
<ul>
<li><em>Polimorfismo inclusivo</em> con le classi</li>
<li><em>Layout in memoria</em> degli oggetti</li>
<li>Il concetto (e il problema) dell’<em>ereditarietà multipla</em></li>
<li><em>Autoboxing</em> dei tipi primitivi</li>
<li>Tipi a run-time (cast, <code>instanceof</code>)</li>
<li><em>Classi astratte</em></li>
</ul>
</section><section>
<h1 id="polimorfismo-inclusivo-con-le-classi">Polimorfismo inclusivo con le classi</h1>
</section><section>
<h2 id="ereditarietà-e-polimorfismo">Ereditarietà e polimorfismo</h2>
<h3 id="ricordando-il-principio-di-sostituibilità">Ricordando il principio di sostituibilità</h3>
<p>SE <code>B</code> è un <em>sottotipo</em> di <code>A</code></p>
<p>ALLORA ogni oggetto di <code>B</code> può/“deve poter” essere utilizzabile dove ci si attende un oggetto di <code>A</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">void</span> <span style="color:#000">m</span>(<span style="color:#000">A</span> <span style="color:#000">a</span>) { <span style="color:#177500">/* ... */</span> }
</span></span><span style="display:flex;"><span><span style="color:#000">B</span> <span style="color:#000">b</span> <span style="color:#000">=</span> <span style="color:#177500">/* ... */</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">A</span> <span style="color:#000">a</span> <span style="color:#000">=</span> <span style="color:#000">b</span>; <span style="color:#177500">// OK</span>
</span></span><span style="display:flex;"><span><span style="color:#000">m</span>(<span style="color:#000">b</span>);    <span style="color:#177500">// OK</span>
</span></span></code></pre></div><h3 id="con-lereditarietà">Con l’ereditarietà</h3>
<ul>
<li>Con la definizione: <code>class B extends A { ... }</code>
<ul>
<li><code>B</code> eredita tutti i membri (campi, metodi) di <code>A</code>, e non può restringerne la visibilità</li>
</ul>
</li>
<li>Gli oggetti della classe <code>B</code> <em>rispondono a tutti i messaggi previsti dalla classe</em> <code>A</code> (ed eventualmente a qualcuno in più)</li>
<li>$\to$ un oggetto di <code>B</code> può essere passato dove se ne aspetta uno di <code>A</code>, senza dare problemi (di “typing”)</li>
</ul>
<p>Cosa mi hai de</p>
<h3 id="conseguenza">Conseguenza:</h3>
<p>Poiché è possibile, corretto, ed utile, allora in Java si considera <code>B</code> come un <em>sottotipo</em> di <code>A</code> a tutti gli effetti!</p>
</section><section>
<h2 id="polimorfismo-con-le-classi">Polimorfismo con le classi</h2>
<p><img src="imgs/uml-poli.png" alt=""></p>
</section><section>
<h2 id="polimorfismo-con-le-classi-1">Polimorfismo con le classi</h2>
<h3 id="in-una-classe-d-che-usi-una-classe-c">In una classe <code>D</code> che usi una classe <code>C</code>…</h3>
<ul>
<li>
<p>ci saranno punti in <code>D</code> in cui ci si attende oggetti della classe <code>C</code></p>
<ul>
<li>come argomenti a metodi, o da depositare nei campi..</li>
</ul>
</li>
<li>
<p>si potranno effettivamente passare oggetti della classe <code>C</code>, ma anche delle classi <code>C1</code>, <code>C2</code>,..,<code>C5</code>, o di ogni altra classe successivamente creata che estende, direttamente o indirettamente <code>C</code></p>
</li>
</ul>
<div class="container">
<div class="col">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">C</span> { <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">foo</span>() { <span style="color:#177500">/*...*/</span> } }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">D</span> { <span style="color:#177500">// rappresenta un generico "contesto"</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">C</span> <span style="color:#000">c</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">void</span> <span style="color:#000">m</span>(<span style="color:#000">C</span> <span style="color:#000">c</span>) { <span style="color:#000">c</span>.<span style="color:#836c28">foo</span>(); }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></div>
<div class="col">
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">C1</span> <span style="color:#a90d91">extends</span> <span style="color:#000">C</span> { }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">C2</span> <span style="color:#a90d91">extends</span> <span style="color:#000">C</span> { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">D</span> <span style="color:#000">d</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">D</span>();
</span></span><span style="display:flex;"><span><span style="color:#000">d</span>.<span style="color:#836c28">c</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">C1</span>(); <span style="color:#177500">// OK</span>
</span></span><span style="display:flex;"><span><span style="color:#000">d</span>.<span style="color:#836c28">m</span>(<span style="color:#a90d91">new</span> <span style="color:#000">C2</span>());  <span style="color:#177500">// OK</span>
</span></span></code></pre></div></div></div>
<h3 id="le-sottoclassi-di-c">Le sottoclassi di <code>C</code></h3>
<p>A tutti gli effetti, gli oggetti di <code>C1</code>, <code>C2</code> … (sottoclassi di <code>C</code>) sono <em>compatibili</em> con gli oggetti della classe <code>C</code></p>
<ul>
<li>supportano lo <em>stesso contratto</em> (in generale, qualche operazione in più)</li>
<li>hanno lo <em>stesso stato</em>, ovvero gli stessi campi definiti in <code>C</code> (in generale, qualcuno in più)</li>
<li>hanno <em>auspicabilmente un comportamento compatibile</em> (cf. “Principle of Least Surprise”)</li>
</ul>
</section><section>
<h2 id="layout-oggetti-in-memoria">Layout oggetti in memoria</h2>
<h3 id="alcuni-aspetti-del-layout-degli-oggetti-in-memoria">Alcuni aspetti del layout degli oggetti in memoria…</h3>
<p>Diamo alcune informazioni generali e astratte. Ogni JVM potrebbe realizzare gli oggetti in modo un po’ diverso. Questi elementi sono tuttavia comuni.</p>
<h3 id="struttura-di-un-oggetto-in-memoria">Struttura di un oggetto in memoria</h3>
<ul>
<li>
<p>Inizia con una intestazione ereditata da <code>Object</code> (16 byte circa), che include</p>
<ul>
<li>Indicazione di quale sia la <em>classe dell’oggetto</em> (runtime type information)</li>
<li><em>Tabella dei puntatori ai metodi</em>, per supportare il late-binding</li>
<li>I campi <!-- (privati) --> della classe <code>Object</code></li>
</ul>
</li>
<li>
<p>Via via tutti i campi della classe, a partire da quelli delle superclassi</p>
</li>
</ul>
<h3 id="conseguenze-se-la-classe-c-è-sottoclasse-di-a">Conseguenze: se la classe <code>C</code> è sottoclasse di <code>A</code>…</h3>
<p>Allora un oggetto di <code>C</code> è simile ad un oggetto di <code>A</code>: ha solo <em>informazioni aggiuntive in fondo</em>, e questo semplifica la sostituibilità!</p>
</section><section>
<h2 id="esempio-applicazione-polimorfismo-fra-classi--uml">Esempio applicazione polimorfismo fra classi – UML</h2>
<p><img src="imgs/uml-person.png" alt=""></p>
</section><section>
<h2 id="person"><code>Person</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Person</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">name</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">private</span> <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">id</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">Person</span>(<span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">name</span>, <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">id</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">super</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span>.<span style="color:#836c28">name</span> <span style="color:#000">=</span> <span style="color:#000">name</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">this</span>.<span style="color:#836c28">id</span> <span style="color:#000">=</span> <span style="color:#000">id</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">getName</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">name</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">getId</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a90d91">return</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">id</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span>() {
</span></span><span style="display:flex;"><span>       <span style="color:#a90d91">return</span> <span style="color:#c41a16">"P [name="</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">name</span> <span style="color:#000">+</span> <span style="color:#c41a16">", id="</span> <span style="color:#000">+</span> <span style="color:#a90d91">this</span>.<span style="color:#836c28">id</span> <span style="color:#000">+</span> <span style="color:#c41a16">"]"</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="student"><code>Student</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Student</span> <span style="color:#a90d91">extends</span> <span style="color:#000">Person</span> {
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">final</span> <span style="color:#a90d91">private</span> <span style="color:#a90d91">int</span> <span style="color:#000">matriculationYear</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">Student</span>(<span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">name</span>, <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">id</span>, 
</span></span><span style="display:flex;"><span>			           <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">matriculationYear</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">super</span>(<span style="color:#000">name</span>, <span style="color:#000">id</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span>.<span style="color:#836c28">matriculationYear</span> <span style="color:#000">=</span> <span style="color:#000">matriculationYear</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">int</span> <span style="color:#000">getMatriculationYear</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">matriculationYear</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#c41a16">"S [getName()="</span> <span style="color:#000">+</span> <span style="color:#000">getName</span>() <span style="color:#000">+</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#c41a16">", getId()="</span> <span style="color:#000">+</span> <span style="color:#000">getId</span>() <span style="color:#000">+</span>
</span></span><span style="display:flex;"><span>				<span style="color:#c41a16">", matriculationYear="</span> <span style="color:#000">+</span> <span style="color:#000">matriculationYear</span> <span style="color:#000">+</span> <span style="color:#c41a16">"]"</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="teacher"><code>Teacher</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Arrays</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Teacher</span> <span style="color:#a90d91">extends</span> <span style="color:#000">Person</span> {
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">final</span> <span style="color:#a90d91">private</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">courses</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">Teacher</span>(<span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">name</span>, <span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">id</span>, 
</span></span><span style="display:flex;"><span>			           <span style="color:#a90d91">final</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">courses</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">super</span>(<span style="color:#000">name</span>, <span style="color:#000">id</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">this</span>.<span style="color:#836c28">courses</span> <span style="color:#000">=</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">courses</span>, <span style="color:#000">courses</span>.<span style="color:#836c28">length</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">getCourses</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// copia difensiva necessaria a preservare incapsulamento</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">copyOf</span>(<span style="color:#000">courses</span>, <span style="color:#000">courses</span>.<span style="color:#836c28">length</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#000">String</span> <span style="color:#000">toString</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#c41a16">"T [getName()="</span> <span style="color:#000">+</span> <span style="color:#000">getName</span>() <span style="color:#000">+</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#c41a16">", getId()="</span> <span style="color:#000">+</span> <span style="color:#000">getId</span>() <span style="color:#000">+</span> 
</span></span><span style="display:flex;"><span>				<span style="color:#c41a16">", courses="</span> <span style="color:#000">+</span> <span style="color:#000">Arrays</span>.<span style="color:#836c28">toString</span>(<span style="color:#000">courses</span>) <span style="color:#000">+</span> <span style="color:#c41a16">"]"</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="useperson"><code>UsePerson</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UsePerson</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>	    
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#a90d91">var</span> <span style="color:#000">people</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Person</span><span style="color:#000">[]</span>{
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Student</span>(<span style="color:#c41a16">"Marco Rossi"</span>,<span style="color:#000">334612</span>,<span style="color:#000">2013</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Student</span>(<span style="color:#c41a16">"Gino Bianchi"</span>,<span style="color:#000">352001</span>,<span style="color:#000">2013</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Student</span>(<span style="color:#c41a16">"Carlo Verdi"</span>,<span style="color:#000">354100</span>,<span style="color:#000">2012</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Teacher</span>(<span style="color:#c41a16">"Mirko Viroli"</span>,<span style="color:#000">34121</span>,<span style="color:#a90d91">new</span> <span style="color:#000">String</span><span style="color:#000">[]</span>{
</span></span><span style="display:flex;"><span>						<span style="color:#c41a16">"OOP"</span>,<span style="color:#c41a16">"PPS"</span>,<span style="color:#c41a16">"PC"</span> 
</span></span><span style="display:flex;"><span>				})
</span></span><span style="display:flex;"><span>		};
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> (<span style="color:#a90d91">final</span> <span style="color:#a90d91">var</span> <span style="color:#000">p</span>: <span style="color:#000">people</span>){
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">p</span>.<span style="color:#836c28">getName</span>()<span style="color:#000">+</span><span style="color:#c41a16">": "</span><span style="color:#000">+</span><span style="color:#000">p</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="la-differenza-col-caso-del-polimorfismo-con-le-interfacce">La differenza col caso del polimorfismo con le interfacce</h2>
<h3 id="polimorfismo-con-le-interfacce">Polimorfismo con le interfacce</h3>
<ul>
<li>La classe <code>D</code> realizza una interfaccia <code>I</code>, ma non eredita da un’altra classe <code>C</code></li>
<li>Si può assumere vi sia un certo <em>contratto</em>, ma non che vi sia uno specifico comportamento <!-- (quello di `C`) che sia stato eventualmente specializzato -->
<ul>
<li>Ad esempio, una classe che realizza l’interfaccia <code>Counter</code> può assumere vi sia un metodo <code>increment()</code>; mentre una classe che eredita da <code>LimitCounter</code> può assumere che <code>increment()</code> sia soggetto a un limite di incrementi unitari</li>
</ul>
</li>
<li>E’ possibile realizzare più interfacce (cioè, supportare più contratti) ma non è possibile (in Java) estendere più classi</li>
</ul>
<h3 id="le-classi-in-java-non-consentono--in-c-si">Le classi in Java <em>non</em> consentono <em>“ereditarietà multipla”</em> (in C++ si)</h3>
<ul>
<li><em>NON</em> è possibile in Java dichiarare: <code>class C extends D1, D2, ... { ... }</code>
<ul>
<li>si creerebbero problemi se <code>D1</code> e <code>D2</code> avessero proprietà comuni (cf. <em>Triangle Problem</em> e <em>Diamond Problem</em>)
<ul>
<li>ad es., quale sarebbe l’implementazione ereditata?</li>
</ul>
</li>
<li>diventerebbe complicato gestire la struttura in memoria dell’oggetto (cf. vtable)</li>
</ul>
</li>
<li>Con le interfacce non ci sono questi problemi, risultato:
<ul>
<li>è molto più semplice prendere una classe esistente e renderla compatibile con una interfaccia <code>I</code>, piuttosto che renderla una specializzazione di una classe <code>C</code></li>
</ul>
</li>
</ul>
</section><section>
<h2 id="riassunto-polimorfismo-inclusivo">Riassunto polimorfismo inclusivo</h2>
<h3 id="polimorfismo">Polimorfismo</h3>
<ul>
<li>Fornisce sopratipi che raccolgono classi uniformi tra loro</li>
<li>Usabili da funzionalità/<em>contesti ad alta riusabilità</em></li>
<li>Utile per costruire <em>collezioni omogenee</em> di oggetti</li>
</ul>
<h3 id="polimorfismo-con-le-interfacce-1">Polimorfismo con le interfacce</h3>
<ul>
<li>Solo relativo ad un <em>contratto</em></li>
<li>Facilità nel far aderire al contratto classi esistenti</li>
<li>Spesso vi è la tendenza a creare un alto numero di interfacce (cf. <em>interface segregation principle</em>)</li>
</ul>
<h3 id="polimorfismo-con-le-classi-2">Polimorfismo con le classi</h3>
<ul>
<li>Relativo a <em>contratto e comportamento</em></li>
<li>In genere ci si aderisce per costruzione dall’inizio</li>
<li>Vincolato dall’ereditarietà singola</li>
</ul>
</section><section>
<h2 id="come-simulare-ereditarietà-multipla">Come simulare ereditarietà multipla?</h2>
<p><img src="imgs/uml-diamond.png" alt=""></p>
</section><section>
<h2 id="come-simulare-ereditarietà-multipla-1">Come simulare ereditarietà multipla?</h2>
<h3 id="definizioni">Definizioni</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">interface</span> <span style="color:#3f6e75">Counter</span> { ... }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">interface</span> <span style="color:#3f6e75">MultiCounter</span> <span style="color:#a90d91">extends</span> <span style="color:#000">Counter</span> { ... }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">interface</span> <span style="color:#3f6e75">BiCounter</span> <span style="color:#a90d91">extends</span> <span style="color:#000">Counter</span> { ... }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">interface</span> <span style="color:#3f6e75">BiAndMultiCounter</span> <span style="color:#a90d91">extends</span> <span style="color:#000">MultiCounter</span>, <span style="color:#000">BiCounter</span> { ... }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">CounterImpl</span> <span style="color:#a90d91">implements</span> <span style="color:#000">Counter</span> { ... }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">MultiCounterImpl</span> <span style="color:#a90d91">extends</span> <span style="color:#000">CounterImpl</span> <span style="color:#a90d91">implements</span> <span style="color:#000">MultiCounter</span>{ ... }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">BiCounterImpl</span> <span style="color:#a90d91">extends</span> <span style="color:#000">CounterImpl</span> <span style="color:#a90d91">implements</span> <span style="color:#000">BiCounter</span> { ... }
</span></span><span style="display:flex;"><span><span style="color:#a90d91">class</span> <span style="color:#3f6e75">BiAndMultiCounterImpl</span> <span style="color:#a90d91">extends</span> <span style="color:#000">BiCounterImpl</span> <span style="color:#a90d91">implements</span> <span style="color:#000">BiAndMultiCounter</span> { ... }
</span></span></code></pre></div><h3 id="implementazione-di-biandmulticounterimpl">Implementazione di <code>BiAndMultiCounterImpl</code></h3>
<ul>
<li>si estende da <code>BiCounterImpl</code>, si delega via composizione ad un oggetto di <code>MultiCounterImpl</code></li>
</ul>
<h3 id="complessivamente">Complessivamente</h3>
<ul>
<li>si ha completa e corretta sostituibilità tramite le interfacce</li>
<li>si ha ottimo riuso delle implementazioni</li>
<li>$\Rightarrow$ si esplori la possibilità di usare solo delegazione, non ereditarietà</li>
</ul>
</section><section>
<h1 id="tipi-a-run-time">Tipi a run-time</h1>
</section><section>
<h2 id="everything-is-an-object">Everything is an <code>Object</code></h2>
<h3 id="perché-avere-una-radice-comune-per-tutte-le-classi">Perché avere una radice comune per tutte le classi?</h3>
<ul>
<li>Consente di fattorizzare lì il <em>comportamento comune ad ogni oggetto</em></li>
<li>Consente la costruzione di <em>funzionalità che lavorano su qualunque oggetto</em></li>
</ul>
<h3 id="esempi-di-applicazione">Esempi di applicazione:</h3>
<ul>
<li>Container polimorfici, ad esempio via array di tipo <code>Object[]</code>
<ul>
<li>permette di costruire un elenco di oggetti di natura anche diversa</li>
<li><code>new Object[]{ new SimpleLamp(), new Integer(10) }</code></li>
</ul>
</li>
<li>Definizione di metodi con numero variabile di argomenti
<ul>
<li>argomenti codificati come <code>Object[]</code></li>
</ul>
</li>
</ul>
</section><section>
<h2 id="uso-di-object">Uso di <code>Object[]</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">import</span> <span style="color:#000">java.util.Arrays</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#177500">/* Tutti gli oggetti possono formare un elenco Object[] */</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">AObject</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">s</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">os</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span><span style="color:#000">[</span><span style="color:#000">5</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">0</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">1</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#c41a16">"stringa"</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">2</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">Integer</span>.<span style="color:#836c28">valueOf</span>(<span style="color:#000">10</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">3</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">int</span><span style="color:#000">[]</span> { <span style="color:#000">10</span>, <span style="color:#000">20</span>, <span style="color:#000">30</span> };
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">4</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">java</span>.<span style="color:#836c28">util</span>.<span style="color:#836c28">Date</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#000">printAll</span>(<span style="color:#000">os</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">Arrays</span>.<span style="color:#836c28">toString</span>(<span style="color:#000">os</span>));
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">Arrays</span>.<span style="color:#836c28">deepToString</span>(<span style="color:#000">os</span>));
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">printAll</span>(<span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">array</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> (<span style="color:#a90d91">final</span> <span style="color:#000">Object</span> <span style="color:#000">o</span> : <span style="color:#000">array</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#c41a16">"Oggetto:"</span> <span style="color:#000">+</span> <span style="color:#000">o</span>.<span style="color:#836c28">toString</span>());
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="tipo-statico-e-tipo-a-run-time">Tipo statico e tipo a run-time</h2>
<h3 id="una-dualità-introdotta-dal-subtyping-polimorfismo-inclusivo">Una dualità introdotta dal subtyping (polimorfismo inclusivo)</h3>
<ul>
<li><em>Tipo statico</em>: il tipo di dato di una variabile dichiarata <!-- espressione desumibile dal compilatore --></li>
<li><em>Tipo run-time</em>: il tipo di dato del valore(/oggetto) effettivamente presente (potrebbe essere un sottotipo di quello statico)
<ul>
<li>in questo caso le chiamate di metodo sono fatte per late-binding</li>
</ul>
</li>
</ul>
<h3 id="esempio-nel-codice-di-printall-dentro-al-for">Esempio nel codice di <code>printAll()</code>, dentro al <code>for</code></h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">printAll</span>(<span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">array</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> (<span style="color:#a90d91">final</span> <span style="color:#000">Object</span> <span style="color:#000">o</span> : <span style="color:#000">array</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#c41a16">"Oggetto:"</span> <span style="color:#000">+</span> <span style="color:#000">o</span>.<span style="color:#836c28">toString</span>());
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><ul>
<li>Tipo statico di <code>o</code> è <code>Object</code></li>
<li>Tipo run-time di <code>o</code> varia di volta in volta: <code>Object</code>, <code>String</code>, <code>Integer</code>, …</li>
</ul>
<h3 id="ispezione-tipo-a-run-time">Ispezione tipo a run-time</h3>
<ul>
<li>In alcuni casi è necessario ispezionare il tipo a run-time</li>
<li>Lo si fa con l’operatore <code>instanceof</code></li>
</ul>
</section><section>
<h2 id="instanceof-e-conversione-di-tipo"><code>instanceof</code> e conversione di tipo</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#177500">/* Everything is an Object, ma quale?? */</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">AObject2</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">s</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">os</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span><span style="color:#000">[</span><span style="color:#000">5</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">0</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">1</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">Integer</span>.<span style="color:#836c28">valueOf</span>(<span style="color:#000">10</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">2</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">Integer</span>.<span style="color:#836c28">valueOf</span>(<span style="color:#000">20</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">3</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#a90d91">int</span><span style="color:#000">[]</span> { <span style="color:#000">10</span>, <span style="color:#000">20</span>, <span style="color:#000">30</span> };
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">4</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">Integer</span>.<span style="color:#836c28">valueOf</span>(<span style="color:#000">30</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#000">printAllAndSum</span>(<span style="color:#000">os</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">/* Voglio anche stampare la somma degli Integer presenti */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">printAllAndSum</span>(<span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">array</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">int</span> <span style="color:#000">sum</span> <span style="color:#000">=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> (<span style="color:#a90d91">final</span> <span style="color:#000">Object</span> <span style="color:#000">o</span> : <span style="color:#000">array</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#c41a16">"Oggetto:"</span> <span style="color:#000">+</span> <span style="color:#000">o</span>.<span style="color:#836c28">toString</span>());
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">if</span> (<span style="color:#000">o</span> <span style="color:#a90d91">instanceof</span> <span style="color:#000">Integer</span>) { <span style="color:#177500">// test a runtime</span>
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">final</span> <span style="color:#000">Integer</span> <span style="color:#000">i</span> <span style="color:#000">=</span> (<span style="color:#000">Integer</span>) <span style="color:#000">o</span>; <span style="color:#177500">// (down)cast</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">sum</span> <span style="color:#000">=</span> <span style="color:#000">sum</span> <span style="color:#000">+</span> <span style="color:#000">i</span>.<span style="color:#836c28">intValue</span>();
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#c41a16">"Somme degli Integer: "</span> <span style="color:#000">+</span> <span style="color:#000">sum</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="instanceof-e-conversione-di-tipo-1"><code>instanceof</code> e conversione di tipo</h2>
<h3 id="ispezione-ed-uso-della-sottoclasse-effettiva">Ispezione ed uso della sottoclasse effettiva</h3>
<p>Data una variabile (o espressione) del tipo statico <code>C</code> può essere necessario capire se sia della sottoclasse <code>D</code>, in tal caso, su tale oggetto si vuole richiamare un metodo specifico della classe <code>D</code>.</p>
<h3 id="coppia-instanceof--conversione">Coppia <code>instanceof</code> + conversione</h3>
<ul>
<li>con l’operatore <code>instanceof</code> si verifica se effettivamente sia di tipo <code>D</code></li>
<li>con la conversione si deposita il riferimento in una espressione con tipo statico <code>D</code></li>
<li>a questo punto si può invocare il metodo</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">C</span> <span style="color:#000">x</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">java</span>.<span style="color:#836c28">util</span>.<span style="color:#836c28">Random</span>().<span style="color:#836c28">nextInt</span>() <span style="color:#000">&gt;</span> <span style="color:#000">0</span> <span style="color:#000">?</span> <span style="color:#a90d91">new</span> <span style="color:#000">D</span>() : <span style="color:#a90d91">null</span>;
</span></span><span style="display:flex;"><span><span style="color:#a90d91">if</span>(<span style="color:#000">x</span> <span style="color:#a90d91">instanceof</span> <span style="color:#000">D</span> <span style="color:#000">d</span>) { <span style="color:#177500">/* codice che usa d */</span> }
</span></span></code></pre></div><h3 id="solo-due-tipi-di-conversione-fra-classi-consentite">Solo due tipi di conversione fra classi consentite</h3>
<ul>
<li><em>Upcast</em>: da sottoclasse a superclasse / classe antenata (spesso automatica)
 <!-- * e.g., da `Integer` ad `Object` -->
</li>
<li><em>Downcast</em>: da superclasse a sottoclasse / classe discendente (potrebbe fallire)
 <!-- * e.g., da `Object` ad `Integer` -->
</li>
</ul>
<!--
```java
Integer i = Integer.valueOf(5);
Object o = i;
Integer i2 = (Integer) o;
o = 1.0;
Integer i3 = (Integer) o; // ClassCastException
```
-->
</section><section>
<h2 id="errori-possibili-connessi-alle-conversioni">Errori possibili connessi alle conversioni</h2>
<h3 id="errori-semantici-a-tempo-di-compilazione-quindi-innocui">Errori semantici (a tempo di compilazione, quindi innocui)</h3>
<ul>
<li>Tentativo di conversione che non sia né upcast né downcast</li>
<li>Chiamata ad un metodo non definito dalla classe (statica) del receiver</li>
</ul>
<h3 id="errori-desecuzione-molto-pericolosi-evitabili-con-linstanceof">Errori d’esecuzione (molto pericolosi, evitabili con l’<code>instanceof</code>)</h3>
<ul>
<li>Downcast verso una classe incompatibile col tipo dinamico, riportato come <code>ClassCastException</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#177500">/* Showing ClassCastException */</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">ShowCCE</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">as</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#000">Object</span> <span style="color:#000">o</span> <span style="color:#000">=</span> <span style="color:#000">Integer</span>.<span style="color:#836c28">valueOf</span>(<span style="color:#000">10</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#000">Integer</span> <span style="color:#000">i</span> <span style="color:#000">=</span> (<span style="color:#000">Integer</span>) <span style="color:#000">o</span>; <span style="color:#177500">// OK</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">String</span> <span style="color:#000">s</span> <span style="color:#000">=</span> (<span style="color:#000">String</span>) <span style="color:#000">o</span>; <span style="color:#177500">// ClassCastException</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// int i = o.intValue(); // No, intValue() non def.</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// String s = (String)i; // No, tipi inconvertibili</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="instanceof-conversioni-e-person"><code>instanceof</code>, conversioni e <code>Person</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">UsePerson2</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">Person</span><span style="color:#000">[]</span> <span style="color:#000">people</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Person</span><span style="color:#000">[]</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Student</span>(<span style="color:#c41a16">"Marco Rossi"</span>, <span style="color:#000">334612</span>, <span style="color:#000">2013</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Student</span>(<span style="color:#c41a16">"Gino Bianchi"</span>, <span style="color:#000">352001</span>, <span style="color:#000">2013</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Student</span>(<span style="color:#c41a16">"Carlo Verdi"</span>, <span style="color:#000">354100</span>, <span style="color:#000">2012</span>),
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">new</span> <span style="color:#000">Teacher</span>(<span style="color:#c41a16">"Mirko Viroli"</span>, <span style="color:#000">34121</span>, 
</span></span><span style="display:flex;"><span>						    <span style="color:#a90d91">new</span> <span style="color:#000">String</span><span style="color:#000">[]</span> { <span style="color:#c41a16">"PO"</span>, <span style="color:#c41a16">"FINF-A"</span>, <span style="color:#c41a16">"ISAC"</span> }) };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> (<span style="color:#a90d91">final</span> <span style="color:#000">Person</span> <span style="color:#000">p</span> : <span style="color:#000">people</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">if</span> (<span style="color:#000">p</span> <span style="color:#a90d91">instanceof</span> <span style="color:#000">Student</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#a90d91">final</span> <span style="color:#000">Student</span> <span style="color:#000">s</span> <span style="color:#000">=</span> (<span style="color:#000">Student</span>) <span style="color:#000">p</span>; <span style="color:#177500">// Qui non fallisce</span>
</span></span><span style="display:flex;"><span>				<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">s</span>.<span style="color:#836c28">getName</span>() <span style="color:#000">+</span> <span style="color:#c41a16">" "</span> <span style="color:#000">+</span> 
</span></span><span style="display:flex;"><span>				                   <span style="color:#000">s</span>.<span style="color:#836c28">getMatriculationYear</span>());
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<!--
# Classi astratte

---



## Motivazioni


  
### Fra interfacce e classi



*  Le interfacce descrivono solo un contratto
*  Le classi definiscono un comportamento completo
*  ...c'è margine per costrutti intermedi?
  


  
### Classi astratte



*  Le **classi astratte** sono usate per descrivere classi dal *comportamento parziale* (ossia, in cui alcuni metodi sono dicharati ma non implementati)
*  Tali classi *non sono istanziabili* (l'operatore `new` non può essere usato)
*  Possono essere estese e ivi completate, da cui la generazione di oggetti
  


  
### Tipica applicazione: pattern *Template Method*


Serve a dichiare uno *schema di strategia* con un **metodo "template"** (spesso `final`) che definisce un comportamento comune, *basato su metodi astratti* da concretizzare in sottoclassi
  



---


## Classi astratte


  
### Una classe astratta:



*  è dichiarata tale: `abstract class C ... { ... }`
*  *non è istanziabile* (in quanto astratta, ovvero non pienamente specificata)
*  può opzionalmente dichiarare *metodi astratti*: 
    *  hanno forma ad esempio: `abstract int m(int a, String s);`
    *  ossia senza body, come nelle dichiarazioni delle interfacce


  


  
### Altri aspetti



*  può definire campi, costruttori, metodi, concreti e non
    *  ...deve definire con cura il loro livello d'accesso
*  può estendere da una classe astratta o non astratta
*  può implementare interfacce, senza essere tenuta ad ottemperarne il contratto
    * i metodi dell'interfaccia implementata, se non implementati, sono astratti
*  *chi estende una classe astratta può essere non-astratto solo se concretizza/implementa tutti i metodi astratti*
  




---


## Esempio: `LimitedLamp` come classe astratta


  
### Obiettivo



*  Vogliamo progettare una estensione di `SimpleLamp` col concetto di esaurimento
*  La strategia con la quale gestire tale esaurimento può essere varia
*  Ma bisogna far sì che qualunque strategia si specifichi, sia garantito che:
    *  la lampadina si accenda solo se non esaurita
    *  in caso di effettiva accensione sia possibile tenerne traccia ai fini della strategia
  


  
### Soluzione


*  Un uso accurato di `abstract`, `final`, e `protected`
*  Daremo tre possibili specializzazioni per una `LimitedLamp`
    1.  che non si esaurisce mai
    2.  che si esaurisce all'n-esima accensione
    3.  che si esaurisce dopo un certo tempo dalla prima accensione




---


## UML complessivo


  ![](imgs/uml-abstract.png)


---


## `SimpleLamp`

```java
public class SimpleLamp {

	private boolean switchedOn;

	public SimpleLamp() {
		this.switchedOn = false;
	}

	public void switchOn() {
		this.switchedOn = true;
	}

	public void switchOff() {
		this.switchedOn = false;
	}

	public boolean isSwitchedOn() {
		return this.switchedOn;
	}
}

```


---


## `LimitedLamp`


```java
public abstract class LimitedLamp extends SimpleLamp {

	public LimitedLamp() {
		super();
	}

	/* Questo metodo è finale: regola la coerenza con okSwitch() e isOver() */
	public final void switchOn() { // TEMPLATE METHOD
		if (!this.isSwitchedOn() && !this.isOver()) {
			super.switchOn();
			this.okSwitch();
		}
	}

	// Cosa facciamo se abbiamo effettivamente acceso? Dipende dalla strategia
	protected abstract void okSwitch();

	/* Strategia per riconoscere se la lamp è esaurita */
	public abstract boolean isOver();

	public String toString() {
		return "Over: " + this.isOver() + ", switchedOn: "	+ this.isSwitchedOn();
	}
}

```


---


## `UnlimitedLamp`


```java
/* Non si esaurisce mai */
public class UnlimitedLamp extends LimitedLamp {

	/* Nessuna informazione extra da tenere */
	public UnlimitedLamp() {
		super();
	}

	/* Allo switchOn.. non faccio nulla */
	protected void okSwitch() {
	}

	/* Non è mai esaurita */
	public boolean isOver() {
		return false;
	}
}

```


---


## `CountdownLamp`


```java
/* Si esaurisce all'n-esima accensione */
public class CountdownLamp extends LimitedLamp {

	/* Quanti switch mancano */
	private int countdown;

	public CountdownLamp(final int countdown) {
		super();
		this.countdown = countdown;
	}

	/* Allo switchOn.. decremento il count */
	protected void okSwitch() {
		this.countdown--;
	}

	/* Finito il count.. lamp esaurita */
	public boolean isOver() {
		return this.countdown == 0;
	}
}

```


---


## `ExpirationTimeLamp`

```java
import java.util.Date;

/* Si esaurisce dopo un certo tempo (reale) dopo la prima accensione */
public class ExpirationTimeLamp extends LimitedLamp {
	/* Tengo il momento dell'accensione e la durata */
	private Date firstSwitchDate;
	private long duration;

	public ExpirationTimeLamp(final long duration) {
		super();
		this.duration = duration;
		this.firstSwitchDate = null;
	}

	/* Alla prima accensione, registro la data */
	protected void okSwitch() {
		if (this.firstSwitchDate == null) {
			this.firstSwitchDate = new java.util.Date();
		}
	}

	/* Esaurita se è passato troppo tempo */
	public boolean isOver() {
		return this.firstSwitchDate != null &&
		   (new Date().getTime() - this.firstSwitchDate.getTime() 
				   >= this.duration);
	}
}

```


---


## `UseLamps`


<div class="smaller">



```java
public class UseLamps {
    // clausola throws Exception qui sotto necessaria!!
    public static void main(String[] s) throws Exception {
        LimitedLamp lamp = new UnlimitedLamp();
        lamp.switchOn();
        System.out.println("ul| " + lamp);
        for (int i = 0; i < 1000; i++) {
            lamp.switchOff();
            lamp.switchOn();
        }
        System.out.println("ul| " + lamp); // non si è esaurita

        lamp = new CountdownLamp(5);
        for (int i = 0; i < 4; i++) {
            lamp.switchOn();
            lamp.switchOff();
        }
        System.out.println("cl| " + lamp);
        lamp.switchOn();
        System.out.println("cl| " + lamp); // al quinto switch si esaurisce

        lamp = new ExpirationTimeLamp(1000); // 1 sec
        lamp.switchOn();
        System.out.println("el| " + lamp);
        Thread.sleep(3000); // attendo 1.1 secs
        System.out.println("el| " + lamp); // dopo 1.1 secs si è esaurita
        lamp.switchOff();
        lamp.switchOn();
        System.out.println("el| " + lamp);
    }
}

```


    
</div>

---


## Classi astratte vs interfacce


  


*  Due versioni quasi equivalenti
*  Unica differenza: ereditarietà singola per classi, ereditarietà multipla per le interfacce
  


```java
/* Versione interfaccia */
public interface Counter {
    void increment();
    int getValue();
} 

/* Versione classe astratta */
public abstract class Counter {
    public abstract void increment();
    public abstract int getValue();
} 
```

---

## Approfondimento: classi astratte vs. interfacce con metodi di default

Interfacce con metodi di default ...

```java
public interface I4 extends I1, I2, I3 {
    void doSomething(String s);
    // da Java 8
    double E = 2.718282; // implicitamente public, static, final
    default void doSomethingTwice(String s) { doSomething(s); doSomething(s); }
    static double PI() { return Math.PI; }
}
```

... sembrano piuttosto simili alle classi astratte, in quanto possono fornire, in aggiunta a un contratto, alcune implementazioni di default

Tuttavia, ci sono differenze cruciali:

- le classi astratte possono definire variabili d'istanza (stato)
- le classi astratte possono definire costruttori
- le classi astratte possono definire membri con visibilità diverse
- le classi astratte possono fare overriding di metodi da `Object`
- i default method non possono essere `final`

---


## Wrap-up su ereditarietà


  
### Il caso più generale:


```java
class C extends D implements I, J, K, L { ... }
```
  

  
### Cosa deve/può fare la classe `C`



*  deve implementare tutti i metodi dichiarati in `I,J,K,L` e super-interfacce
*  può fare overriding dei metodi (non finali) definiti in `D` e superclassi
  


  
### Classe astratta:


```java
abstract class CA extends D implements I, J, K, L { ... }
```
  

  
### Cosa deve/può fare la classe `CA`



*  non è tenuta a implementare alcun metodo
*  può implementare qualche metodo per definire un comportamento parziale
  




---

-->
<h1 id="autoboxing-dei-tipi-primitivi-e-argomenti-variabili">Autoboxing dei tipi primitivi, e argomenti variabili</h1>
</section><section>
<h2 id="autoboxing-dei-tipi-primitivi">Autoboxing dei tipi primitivi</h2>
<h3 id="già-conosciamo-i-wrapper-dei-tipi-primitivi">Già conosciamo i Wrapper dei tipi primitivi</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000">Integer</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Integer</span>(<span style="color:#000">10</span>); <span style="color:#177500">// Deprecated in Java 17 (for removal)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">Integer</span>.<span style="color:#836c28">valueOf</span>(<span style="color:#000">10</span>);  <span style="color:#177500">// recommended</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Double</span>  <span style="color:#000">d</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Double</span>(<span style="color:#000">10</span>.<span style="color:#836c28">5</span>); <span style="color:#177500">// Deprecated in Java 17 (for removal)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">d</span> <span style="color:#000">=</span> <span style="color:#000">Double</span>.<span style="color:#836c28">valueOf</span>(<span style="color:#000">10</span>.<span style="color:#836c28">5</span>); <span style="color:#177500">// recommended</span>
</span></span></code></pre></div><p>..ossia, ogni valore primitivo può essere “impacchettato” (“boxed”) in un oggetto</p>
<h3 id="autoboxing">Autoboxing</h3>
<ul>
<li>Un meccanismo di Java per supportare l’equivalenza fra tipi primitivi e loro Wrapper</li>
<li>Due meccanismi:
<ul>
<li>Se si trova un primitivo dove ci si attende un oggetto, se ne fa il <strong>boxing</strong></li>
<li>Se si trova un wrapper dove ci si attende un primitivo, si fa il <strong>de-boxing</strong></li>
</ul>
</li>
</ul>
<h3 id="risultato">Risultato</h3>
<ul>
<li>Si simula meglio l’idea “Everything is an Object”</li>
<li>Anche i tipi primitivi sono usabili ad esempio con <code>Object[]</code></li>
</ul>
</section><section>
<h2 id="uso-dellautoboxing">Uso dell’autoboxing</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#177500">/* Showcase dell'autoboxing */</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">Boxing</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">s</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">Object</span><span style="color:#000">[]</span> <span style="color:#000">os</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span><span style="color:#000">[</span><span style="color:#000">5</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">0</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Object</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">1</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">5</span>; <span style="color:#177500">// equivale a os[1]=new Integer(5);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">2</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">10</span>; <span style="color:#177500">// equivale a os[2]=new Integer(10);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">3</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#a90d91">true</span>; <span style="color:#177500">// equivale a os[3]=new Boolean(true);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">os</span><span style="color:#000">[</span><span style="color:#000">4</span><span style="color:#000">]</span> <span style="color:#000">=</span> <span style="color:#000">20</span>.<span style="color:#836c28">5</span>; <span style="color:#177500">// equivale a os[4]=new Double(20.5);</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#000">Integer</span><span style="color:#000">[]</span> <span style="color:#000">is</span> <span style="color:#000">=</span> <span style="color:#a90d91">new</span> <span style="color:#000">Integer</span><span style="color:#000">[]</span> { <span style="color:#000">10</span>, <span style="color:#000">20</span>, <span style="color:#000">30</span>, <span style="color:#000">40</span> };
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">final</span> <span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">is</span><span style="color:#000">[</span><span style="color:#000">0</span><span style="color:#000">]</span> <span style="color:#000">+</span> <span style="color:#000">is</span><span style="color:#000">[</span><span style="color:#000">1</span><span style="color:#000">]</span> <span style="color:#000">+</span> <span style="color:#000">is</span><span style="color:#000">[</span><span style="color:#000">2</span><span style="color:#000">]</span> <span style="color:#000">+</span> <span style="color:#000">is</span><span style="color:#000">[</span><span style="color:#000">3</span><span style="color:#000">]</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// equivale a: is[0].intValue()+ is[1].intValue()+..</span>
</span></span><span style="display:flex;"><span>		<span style="color:#177500">// non funzionerebbe se 'is' avesse tipo Object[]..</span>
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#c41a16">"Somma: "</span> <span style="color:#000">+</span> <span style="color:#000">i</span>); <span style="color:#177500">// 100</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section><section>
<h2 id="variable-arguments">Variable arguments</h2>
<h3 id="a-volte-è-utile-che-i-metodi-abbiano-un-numero-variabile-di-argomenti">A volte è utile che i metodi abbiano un numero variabile di argomenti</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">int</span> <span style="color:#000">i</span> <span style="color:#000">=</span> <span style="color:#000">sum</span>(<span style="color:#000">10</span>, <span style="color:#000">20</span>, <span style="color:#000">30</span>, <span style="color:#000">40</span>, <span style="color:#000">50</span>, <span style="color:#000">60</span>, <span style="color:#000">70</span>);
</span></span><span style="display:flex;"><span><span style="color:#000">printAll</span>(<span style="color:#000">10</span>, <span style="color:#000">20</span>, <span style="color:#000">3</span>.<span style="color:#836c28">5</span>, <span style="color:#a90d91">new</span> <span style="color:#000">Object</span>());
</span></span></code></pre></div><ul>
<li>prima di Java 5 si simulava passando un unico array</li>
</ul>
<h3 id="variable-arguments-1">Variable arguments</h3>
<ul>
<li>L’ultimo (o unico) argomento di un metodo può essere del tipo “<code>Type... argname</code>”</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">void</span> <span style="color:#000">m</span>(<span style="color:#a90d91">int</span> <span style="color:#000">a</span>, <span style="color:#a90d91">float</span> <span style="color:#000">b</span>, <span style="color:#000">Object</span>... <span style="color:#000">argname</span>) { ... }
</span></span></code></pre></div><ul>
<li>Nel body del metodo, <code>argname</code> è trattato come un <code>Type[]</code></li>
<li>Chi chiama il metodo, invece che passare un array, passa una lista di argomenti di tipo <code>Type</code></li>
<li>Funziona automaticamente con polimorfismo, autoboxing, <code>instanceof</code>, …</li>
</ul>
</section><section>
<h2 id="uso-dei-variable-arguments">Uso dei variable arguments</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#a90d91">public</span> <span style="color:#a90d91">class</span> <span style="color:#3f6e75">VarArgs</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// somma un numero variabile di Integer</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">int</span> <span style="color:#000">sum</span>(<span style="color:#a90d91">final</span> <span style="color:#000">Integer</span>... <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">int</span> <span style="color:#000">sum</span> <span style="color:#000">=</span> <span style="color:#000">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">for</span> (<span style="color:#a90d91">int</span> <span style="color:#000">i</span> : <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#000">sum</span> <span style="color:#000">=</span> <span style="color:#000">sum</span> <span style="color:#000">+</span> <span style="color:#000">i</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">return</span> <span style="color:#000">sum</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#177500">// stampa il contenuto degli argomenti, se meno di 10</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">printAll</span>(<span style="color:#a90d91">final</span> <span style="color:#000">String</span> <span style="color:#000">start</span>, <span style="color:#a90d91">final</span> <span style="color:#000">Object</span>... <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">start</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#a90d91">if</span> (<span style="color:#000">args</span>.<span style="color:#836c28">length</span> <span style="color:#000">&lt;</span> <span style="color:#000">10</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#a90d91">for</span> (<span style="color:#a90d91">final</span> <span style="color:#000">Object</span> <span style="color:#000">o</span> : <span style="color:#000">args</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">o</span>);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a90d91">public</span> <span style="color:#a90d91">static</span> <span style="color:#a90d91">void</span> <span style="color:#000">main</span>(<span style="color:#000">String</span><span style="color:#000">[]</span> <span style="color:#000">s</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">println</span>(<span style="color:#000">sum</span>(<span style="color:#000">10</span>, <span style="color:#000">20</span>, <span style="color:#000">30</span>, <span style="color:#000">40</span>, <span style="color:#000">50</span>, <span style="color:#000">60</span>, <span style="color:#000">70</span>, <span style="color:#000">80</span>));
</span></span><span style="display:flex;"><span>		<span style="color:#000">printAll</span>(<span style="color:#c41a16">"inizio"</span>, <span style="color:#000">1</span>, <span style="color:#000">2</span>, <span style="color:#000">3</span>.<span style="color:#836c28">2</span>, <span style="color:#a90d91">true</span>, <span style="color:#a90d91">new</span> <span style="color:#a90d91">int</span><span style="color:#000">[]</span> { <span style="color:#000">10</span> }, <span style="color:#a90d91">new</span> <span style="color:#000">Object</span>());
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>		<span style="color:#000">System</span>.<span style="color:#836c28">out</span>.<span style="color:#836c28">format</span>(<span style="color:#c41a16">"%d %d\n"</span>, <span style="color:#000">10</span>, <span style="color:#000">20</span>); <span style="color:#177500">// C-like printf</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><!--

---

# Alcuni pattern basati sulle classe astratte


---



## Pattern **Template Method**: comportamentale, su classi

### Intento/motivazione

Definisce lo scheletro (template) di un algoritmo (o comportamento), lasciando l'indicazione di alcuni suoi aspetti alle sottoclassi.

### Esempi

* Definizione della logica di accensione (`switchOn`) di una lampadina (`Lamp`)
* Un comparatore può fornire metodi template per capire se un oggetto è minore/maggiore/uguale di un altro, sulla base di un metodo astratto `int compareTo(T a, T b)`
* In un input stream (`InputStream`), i vari metodi di lettura sono dei Template Method: dipendono dall'implementazione del solo concetto di lettura di un `int`

<!--
* Implementazione del pattern **Factory Method**: il metodo template usa un factory method per definire un comportamento astraendo dall'implementazione specifica di uno o più oggetti coinvolti
* In un input stream (`InputStream`), i vari metodi di lettura sono dei Template Method: dipendono dall'implementazione del solo concetto di lettura di un `int`
	%*  Similmente, i metodi di `AbstractSet` tranne `size()` e `iterator()`
	*  Le interfacce funzionali con metodi di default che chiamano l'astratto
    }}


### Soluzione

* L'algoritmo è realizzato attraverso un **metodo template** che *realizza un algoritmo chiamando metodi astratti/da specializzare* quando servono gli aspetti non noti a priori
* Una sottoclasse fornisce l'implementazione dei metodi astratti

<!--
* L'algoritmo è realizzato attraverso un metodo non astratto (il template method) di una classe astratta
* Questo realizza l'algoritmo, chiamando metodi astratti quando servono gli aspetti non noti a priori
* Una sottoclasse fornisce l'implementazione dei metodi astratti
-->
</section><section>
<!-- ![](imgs/template_method.jpg) -->
<!--
<div class="container">
<div class="col">

```mermaid
classDiagram

    class AbstractClass {
        TemplateMethod()
        PrimitiveOp1()
        PrimitiveOp2()
    }

    class ConcreteClass {
        PrimitiveOp1()
        PrimitiveOp2()
    }

AbstractClass <|-- ConcreteClass
```

</div>
<div class="col">

```java
abstract class AbstractClass {
    public void TemplateMethod() {
        // ...
        PrimitiveOp1();
        // ...
        PrimitiveOp2();
        // ...
    }
    public abstract void PrimitiveOp1();
    public abstract void PrimitiveOp2();
}

class ConcreteClass extends AbstractClass {
    public void PrimitiveOp1() { /* ... */ }
    public void PrimitiveOp2() { /* ... */ }
}
```

</div></div>

---

<!--

## Template Method: Una estensione di `InputStream`



```java
import java.io.*;
import java.util.*;

public class UseRandomInputStream {

	public static void main(String[] args) throws IOException {
		
		// Il metodo InputStream.read(byte[]) è un Template Method
		// Dipende dall'implementazione (non nota) di InputStream.read()
		
		// Creo una sottoclasse in cui concretizzo read()
		InputStream	input = new InputStream(){ // Uno stream ad-hoc
			int ct = 0;
			public int read() throws IOException {
				return ct++;
			}
		};
		
		// Ora provo InputStream.read(byte[]) e lo trovo concretizzato
		final byte[] b = new byte[100];
		input.read(b);
		System.out.println(Arrays.toString(b));
		// [0,1,2,3,4,5,6,..]
	}
}

```


---

-->
<!--
## Template Method: esempio `BankAccount`

<div class="smaller">



```java
public abstract class BankAccount {
	private int amount;
	
	public BankAccount(int amount){
		this.amount = amount;
	}
	
	public abstract int operationFee(); // costo bancario operazione
	
	public int getAmount(){
		return this.amount;
	}
	
	public void withdraw(int n){	// template method
		this.amount = this.amount - n - this.operationFee();
	}

	public static void main(String[] args){
		final BankAccount b = new BankAccountWithConstantFee(100);
		b.withdraw(20);
		System.out.println(b.getAmount()); // 79
	}
}

class BankAccountWithConstantFee extends BankAccount {
	public BankAccountWithConstantFee(int amount) {
		super(amount);
	}

	public int operationFee(){ return 1; }	
}
```


    
</div>

---

<!--

## Pattern **Decorator**: strutturale, su oggetti


    
### Intento/motivazione


*Aggiunge ad un oggetto ulteriori responsabilità, dinamicamente*: cioè, lo "decora". E lo fa in modo più flessibile (e componibile) rispetto all'ereditarietà.
    

    
### Esempi

*  Aggiunta del "tempo di vita" ad una lampadina
*  Aggiunta di "logging" (stampe in output/su file) alle operazioni di un oggetto
*  Aggiunta di una una barra di scorrimento ad un pannello in una GUI (temi che vedremo)
*  Ottenere uno stream ordered da uno unordered (temi che vedremo)
*  Aggiungere (in modo componibile) la gestione "buffered" ad uno stream

    
### Soluzione


* Il *decoratore* ha un riferimento al *componente* e definisce un'interfaccia che è conforme a quella del *componente*: il *decoratore* fa "forwarding" delle richieste al *componente*, e può svolgere altre operazioni prima e/o dopo 
* $\Rightarrow$ può essere visto come variante dello strategy (in cui la strategia è "il comportamento di base" del componente), e potrebbe includere dei template method
    

---


## Decorator: UML


![](imgs/decorator.jpg)


---


## Esempio di problema


    
### Data la seguente interfaccia `Pizza`..


```java
public interface Pizza {
	int getCost(); // prezzo in centesimi di euro
	String getIngredients(); // lista di ingredienti a menù
}

```
    

    
### Realizzare le seguenti astrazioni



*  Margherita (6.50 euro, ingredienti: pomodoro + mozzarella)
*  Aggiunta Salsiccia (1.50 euro), anche doppia o tripla eccetera
*  Aggiunta Funghi (1 euro), anche doppia o tripla eccetera
*  Pizza senza glutine (+10% costo) 
    


    
### Forniamo la soluzione col decoratore (tipica del concetto di "ingrediente")



*  Classe concreta `Margherita`
*  Decoratore astratto `IngredientDecorator`
*  Specializzazioni `Salsiccia`, `Funghi` e `GlutenFree`
    




---


## Funzionalità di testing

```java
	
	@Test
	public void test(){
		Pizza p1 = new Mushrooms(new Sausage(new Margherita()));
		Pizza p2 = new Margherita();
		Pizza p3 = new Sausage(new Sausage(new Margherita())); // Ingrediente usato due volte (ossia doppio)
		Pizza p4 = new GlutFree(new Sausage(new Sausage(new Margherita())));
		// stampe di comodo
		System.out.println(p1.getCost()+" "+p1.getIngredients());
		System.out.println(p2.getCost()+" "+p2.getIngredients());
		System.out.println(p3.getCost()+" "+p3.getIngredients());
		System.out.println(p4.getCost()+" "+p4.getIngredients());
		// test correttezza di costi e stringhe
		assertEquals(p1.getCost(),900); // 6.50 + 1.00 + 1.50
		assertEquals(p2.getCost(),650);
		assertEquals(p3.getCost(),950); // 6.50 + 1.50 + 1.50
		assertEquals(p4.getCost(),1045);// (6.50 + 1.50 + 1.50) + 10%
		assertEquals(p1.getIngredients(),"Tomato, Mozzarella, Sausage, Mushrooms");
		assertEquals(p2.getIngredients(),"Tomato, Mozzarella");
		assertEquals(p3.getIngredients(),"Tomato, Mozzarella, Sausage, Sausage");
		assertEquals(p4.getIngredients(),"[GF] Tomato, Mozzarella, Sausage, Sausage");	
	}
}

```


---


## Classe `Margherita`


```java
/*
 * This is the basic Pizza of all
 */

public class Margherita implements Pizza {
	public int getCost() {
		return 650;
	}

	public String getIngredients() {
		return "Tomato, Mozzarella";
	}
}

```

---


## Classe `IngredientDecorator`



```java
public abstract class IngredientDecorator implements Pizza {
	protected final Pizza decorated;

	protected IngredientDecorator(Pizza decorated) {
		this.decorated = decorated;
	}

	public int getCost() {
		return this.decorated.getCost();
	}

	public String getIngredients() {
		return this.decorated.getIngredients();
	}
}

```

---

## Classe `BasicIngredient`

```java
public class BasicIngredient extends IngredientDecorator {
	private final String name;
	private final int cost;

	public BasicIngredient(String name, int cost, Pizza p) {
		super(p);
		this.name = name;
		this.cost = cost;
	}

	public int getCost() {
		return super.getCost() + this.cost;
	}

	public String getIngredients() {
		return super.getIngredients() + ", " + this.name;
	}
}

```

---


## Classi per gli ingredienti..

<div class="container">
<div class="col">

```java
public class Sausage extends BasicIngredient {
	public Sausage(Pizza p) {
		super("Sausage", 150, p);
	}
}

```

```java
public class Mushrooms extends BasicIngredient {
	public Mushrooms(Pizza p) {
		super("Mushrooms", 100, p);
	}
}

```

</div>
<div class="col">

```java
public class GlutFree extends IngredientDecorator {

	public GlutFree(Pizza p) {
		super(p);
	}

	public int getCost() {
		return (int) (super.getCost() * 1.1);
	}

	public String getIngredients() {
		return "[GF] " + super.getIngredients();
	}

}

```

</div></div>


---

-->
<h2 id="preview-del-prossimo-laboratorio">Preview del prossimo laboratorio</h2>
<h3 id="obiettivi">Obiettivi</h3>
<p>Familiarizzare con:</p>
<ul>
<li>Estensione delle classi e corrispondente polimorfismo</li>
<li>Classi astratte</li>
<li>Tipi a run-time e boxing</li>
</ul>
</section><section>
<h1 id="polimorfismo-e-tipi-a-runtime-1">Polimorfismo e tipi a runtime</h1>
<h4 id="progettazione-e-sviluppo-del-software">Progettazione e Sviluppo del Software</h4>
<h4 id="cdl-tecnologie-dei-sistemi-informatici">C.D.L. Tecnologie dei Sistemi Informatici</h4>
<h3 id="danilo-pianini"><a href="mailto:danilo.pianini@unibo.it">Danilo Pianini — <code>danilo.pianini@unibo.it</code></a></h3>
<h3 id="gianluca-aguzzi"><a href="mailto:gianluca.aguzzi@unibo.it">Gianluca Aguzzi — <code>gianluca.aguzzi@unibo.it</code></a></h3>
<h3 id="angelo-filaseta"><a href="mailto:angelo.filaseta@unibo.it">Angelo Filaseta — <code>angelo.filaseta@unibo.it</code></a></h3>
<p>Compiled on: 2025-11-13
 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> versione stampabile</a></p>
<p><a href=".."><i class="fa fa-undo" aria-hidden="true"></i> back</a></p>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/reveal-hugo/object-assign.js"></script>

<a href="/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"900","highlight_theme":"default","history":true,"mermaid":[{"startOnLoad":false}],"slide_number":true,"theme":"white","transition":"slide","transition_speed":"fast","width":"1440"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = {
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>







  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
    
  
  

  
  

  
    
  
  

  
  

  
  

  
    
  
  

  
  

  
  

  
    
  
  

  
    
  
  

  
  

  
  

  
  

  
    
  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.3/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({"startOnLoad":false});

    let render = (event) => {
      let mermaidElems = event.currentSlide.querySelectorAll('.mermaid');
      if (!mermaidElems.length){
          return
      }
      mermaidElems.forEach(mermaidElem => {
          let processed = mermaidElem.getAttribute('data-processed');
          if (!processed){
              
              mermaid.init(undefined, mermaidElem);
          }
      });
    };
    
    render({currentSlide: Reveal.getCurrentSlide()});

    Reveal.on('slidechanged', render);
    Reveal.on('ready', render);
  </script>



    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>

    
  

</body></html>